var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var network = require('../network');
var trainer = require('../trainer');
var Layer = require('../layer');
var Squash = require('../squash');
var Utils = (function () {
    function Utils() {
    }
    Utils.softMax = function (array, sharpen) {
        // for all i ∈ array
        // sum = ∑ array[n]^e
        // i = î^e / sum
        // where the result ∑ array[0..n] = 1
        if (sharpen === void 0) { sharpen = 1; }
        if (!array.length)
            return array;
        sharpen = sharpen || 1;
        var sum = 0;
        for (var i = 0; i < array.length; i++) {
            array[i] = Math.exp(sharpen * array[i]);
            sum += array[i];
        }
        if (sum != 0) {
            for (var i = 0; i < array.length; i++)
                array[i] /= sum;
        }
        else {
            var div = 1 / array.length;
            for (var i = 0; i < array.length; i++)
                array[i] = div;
        }
        return array;
    };
    Utils.getCosineSimilarity = function (arrayA, arrayB) {
        // http://en.wikipedia.org/wiki/Cosine_similarity
        // NTM: 3.3.1 (6)
        var dotPr = 0;
        var acumA = 0, acumB = 0;
        for (var i = 0; i < arrayA.length; i++) {
            dotPr += arrayA[i] * arrayB[i];
            acumA += arrayA[i] * arrayA[i];
            acumB += arrayB[i] * arrayB[i];
        }
        return dotPr / (Math.sqrt(acumA) * Math.sqrt(acumB) + .00005);
    };
    Utils.interpolateArray = function (output_inputA, inputB, g) {
        // 3.3.2 focus by location (7)
        var gInverted = 1 - g;
        for (var i = 0; i < output_inputA.length; i++)
            output_inputA[i] = output_inputA[i] * g + gInverted * inputB[i];
        return output_inputA;
    };
    // w_sharpWn
    Utils.sharpArray = function (output, wn, Y) {
        // 3.3.2 (9)
        var sum = 0;
        for (var i = 0; i < wn.length; i++) {
            wn[i] = Math.pow(wn[i], Y);
            sum += wn[i];
        }
        // ∀ a ∈ wn → a = a^Y / sum
        if (sum != 0) {
            for (var i = 0; i < wn.length; i++)
                output[i] = wn[i] / sum;
        }
        else {
            var div = 1 / wn.length;
            for (var i = 0; i < wn.length; i++)
                output[i] = div;
        }
    };
    //wn_shift
    Utils.scalarShifting = function (wg, shiftScalar) {
        // w~ 3.3.2 (8)
        var shiftings = new Float64Array(wg.length);
        var wn = new Float64Array(wg.length);
        var intPart = shiftScalar | 0;
        var decimalPart = shiftScalar - intPart;
        shiftings[intPart % shiftings.length] = 1 - decimalPart;
        shiftings[(intPart + 1) % shiftings.length] = decimalPart;
        for (var i = 0; i < wn.length; i++) {
            var acum = 0;
            for (var j = 0; j < wn.length; j++) {
                if ((i - j) < 0)
                    acum += wg[j] * shiftings[shiftings.length - Math.abs(i - j)];
                else
                    acum += wg[j] * shiftings[(i - j) % shiftings.length];
            }
            wn[i] = acum;
        }
        return wn;
    };
    Utils.vectorShifting = function (wg, shiftings) {
        // w~ 3.3.2 (8)
        var wn = new Float64Array(wg.length);
        for (var i = 0; i < wn.length; i++) {
            var acum = 0;
            for (var j = 0; j < wn.length; j++) {
                if ((i - j) < 0)
                    acum += wg[j] * shiftings[shiftings.length - Math.abs(i - j)];
                else
                    acum += wg[j] * shiftings[(i - j) % shiftings.length];
            }
            wn[i] = acum;
        }
        wg.set(wn);
    };
    return Utils;
})();
exports.Utils = Utils;
var NTM = (function (_super) {
    __extends(NTM, _super);
    function NTM(inputs, outputs, memBlocks, blockWidth, heads, hiddenSize) {
        // build the memory
        _super.call(this);
        this.heads = new Array();
        this.dirty = false;
        this.trainer = new trainer.Trainer(this);
        this.blocks = memBlocks;
        this.blockWidth = blockWidth;
        this.data = new Array(this.blocks);
        this.clean();
        // build the network
        var inputLength = inputs + heads * memBlocks;
        this.inputValues = new Float64Array(inputLength);
        this.layers.input = this.inputLayer = new Layer.Layer(inputLength);
        this.hiddenLayer = new Layer.Layer(hiddenSize);
        this.layers.output = this.outputLayer = new Layer.Layer(outputs);
        this.inputLayer.project(this.hiddenLayer, Layer.Layer.connectionType.ALL_TO_ALL);
        this.hiddenLayer.project(this.outputLayer, Layer.Layer.connectionType.ALL_TO_ALL);
        var inputCounter = inputs - 1;
        for (var headIndex = 0; headIndex < heads; headIndex++) {
            this.addHead(this.inputValues.subarray(inputCounter, inputCounter + memBlocks));
            inputCounter += memBlocks;
        }
        this.optimized = false;
    }
    NTM.prototype.clean = function () {
        for (var location = 0; location < this.blocks; location++) {
            var array = this.data[location] = new Float64Array(this.blockWidth);
            for (var i = 0; i < array.length; i++) {
                array[i] = Math.random();
            }
            Utils.softMax(array);
        }
        this.dirty = false;
    };
    NTM.prototype.activate = function (input) {
        this.inputValues.set(input);
        this.inputLayer.activate(this.inputValues);
        this.hiddenLayer.activate();
        this.doTimeStep();
        return this.outputLayer.activate();
    };
    NTM.prototype.propagate = function (rate, target) {
        this.outputLayer.propagate(rate, target);
        for (var i = this.heads.length - 1; i >= 0; i--) {
            this.heads[i].layer.propagate(rate);
        }
        this.hiddenLayer.propagate(rate);
        this.dirty = true;
    };
    NTM.prototype.addHead = function (subArray) {
        var head = new Head(this, subArray);
        this.heads.push(head);
        return head;
    };
    NTM.prototype.doTimeStep = function () {
        var _this = this;
        this.heads.forEach(function (head, headIndex) {
            head.doTimeStep();
        });
        // parallelizable
        this.heads.forEach(function (head, headIndex) {
            _this.doErase(head.w_weightings, head.eraseGate);
        });
        // parallelizable
        this.heads.forEach(function (head, headIndex) {
            _this.doAdd(head.w_weightings, head.addGate);
        });
        //this.data.forEach((e) => e = Utils.softMax(e))
    };
    NTM.prototype.doAdd = function (w, addGate) {
        for (var n = 0; n < this.blocks; n++) {
            var M = this.data[n];
            for (var i = 0; i < this.blockWidth; i++) {
                M[i] += addGate[n] * w[i];
            }
        }
    };
    NTM.prototype.doErase = function (w, eraseGate) {
        for (var n = 0; n < this.blocks; n++) {
            var M = this.data[n];
            for (var i = 0; i < this.blockWidth; i++) {
                M[i] *= 1 - eraseGate[n] * w[i];
            }
        }
    };
    return NTM;
})(network.Network);
exports.NTM = NTM;
function normalizeShift(shift) {
    var sum = 0;
    for (var i = 0; i < shift.length; i++) {
        sum += shift[i];
    }
    for (var j = 0; j < shift.length; j++) {
        shift[j] /= sum;
    }
}
var Head = (function () {
    function Head(memory, destinationArray) {
        this.s_shiftingValue = null;
        this.prevFocus = 1;
        this.memory = memory;
        this.wc_focusedWeights = new Float64Array(this.memory.blocks);
        this.w_weightings = new Float64Array(this.memory.blocks);
        this.s_shiftingVector = new Float64Array(this.memory.blocks);
        this.k_keys = new Float64Array(this.memory.blockWidth);
        this.ß_keyStrength = 0;
        this.eraseGate = new Float64Array(this.memory.blocks);
        this.addGate = new Float64Array(this.memory.blocks);
        this.readVector = destinationArray || new Float64Array(this.memory.blocks);
        this.layer = new Layer.Layer(this.memory.blockWidth * 4 + Head.ADDITIONAL_INPUT_VALUES);
        this.memory.hiddenLayer.project(this.layer, Layer.Layer.connectionType.ALL_TO_ALL);
        this.layer.project(this.memory.outputLayer, Layer.Layer.connectionType.ALL_TO_ALL);
    }
    Head.prototype.doTimeStep = function () {
        var activation = this.layer.activate();
        this.ß_keyStrength = Squash.SOFTPLUS(activation[0]);
        this.g_interpolation = Squash.LOGISTIC(activation[1], true);
        this.Y_focus = Math.exp(activation[2]) + 10;
        var startAt = 3;
        for (var k = 0; k < this.k_keys.length; k++) {
            this.k_keys[k] = this.layer.list[k + startAt].activation;
        }
        startAt += this.k_keys.length;
        for (var k = 0; k < this.k_keys.length; k++) {
            this.addGate[k] = this.layer.list[k + startAt].derivative;
        }
        startAt += this.k_keys.length;
        for (var k = 0; k < this.k_keys.length; k++) {
            this.eraseGate[k] = this.layer.list[k + startAt].activation;
        }
        startAt += this.k_keys.length;
        for (var k = 0; k < this.k_keys.length; k++) {
            this.s_shiftingVector[k] = this.layer.list[k + startAt].activation;
        }
        /*} else {
          this.prevFocus++;
          this.prevFocus = this.prevFocus % this.k_keys.length;
          
          for (var k = 0; k < this.k_keys.length; k++) {
            this.s_shiftingVector[k] = 0;
          }
          
          this.s_shiftingVector[this.prevFocus] = 1;
        }*/
        var M = this.memory.data;
        for (var i = 0; i < M.length; i++)
            this.wc_focusedWeights[i] = Utils.getCosineSimilarity(M[i], this.k_keys);
        // focus by location (interpolation)
        Utils.interpolateArray(this.wc_focusedWeights, this.w_weightings, this.g_interpolation);
        // convolutional shift
        Utils.softMax(this.s_shiftingVector, 10);
        Utils.vectorShifting(this.wc_focusedWeights, this.s_shiftingVector);
        // sharpening
        Utils.sharpArray(this.w_weightings, this.wc_focusedWeights, this.Y_focus);
        for (var index = 0; index < this.memory.blocks; index++) {
            this.readVector[index] = 0;
            for (var cell = 0; cell < this.memory.blockWidth; cell++) {
                this.readVector[index] += this.memory.data[index][cell] * this.w_weightings[index];
            }
        }
    };
    Head.ADDITIONAL_INPUT_VALUES = 3;
    return Head;
})();
exports.Head = Head;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcmNoaXRlY3QvTlRNLnRzIl0sIm5hbWVzIjpbIlV0aWxzIiwiVXRpbHMuY29uc3RydWN0b3IiLCJVdGlscy5zb2Z0TWF4IiwiVXRpbHMuZ2V0Q29zaW5lU2ltaWxhcml0eSIsIlV0aWxzLmludGVycG9sYXRlQXJyYXkiLCJVdGlscy5zaGFycEFycmF5IiwiVXRpbHMuc2NhbGFyU2hpZnRpbmciLCJVdGlscy52ZWN0b3JTaGlmdGluZyIsIk5UTSIsIk5UTS5jb25zdHJ1Y3RvciIsIk5UTS5jbGVhbiIsIk5UTS5hY3RpdmF0ZSIsIk5UTS5wcm9wYWdhdGUiLCJOVE0uYWRkSGVhZCIsIk5UTS5kb1RpbWVTdGVwIiwiTlRNLmRvQWRkIiwiTlRNLmRvRXJhc2UiLCJub3JtYWxpemVTaGlmdCIsIkhlYWQiLCJIZWFkLmNvbnN0cnVjdG9yIiwiSGVhZC5kb1RpbWVTdGVwIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFPLE9BQU8sV0FBVyxZQUFZLENBQUMsQ0FBQztBQUN2QyxJQUFPLE9BQU8sV0FBVyxZQUFZLENBQUMsQ0FBQztBQUN2QyxJQUFPLEtBQUssV0FBVyxVQUFVLENBQUMsQ0FBQztBQUduQyxJQUFPLE1BQU0sV0FBVyxXQUFXLENBQUMsQ0FBQztBQUVyQyxJQUFhLEtBQUs7SUFBbEJBLFNBQWFBLEtBQUtBO0lBd0hsQkMsQ0FBQ0E7SUF2SFFELGFBQU9BLEdBQWRBLFVBQWlEQSxLQUFRQSxFQUFFQSxPQUFXQTtRQUNwRUUsb0JBQW9CQTtRQUNwQkEscUJBQXFCQTtRQUNyQkEsZ0JBQWdCQTtRQUNoQkEscUNBQXFDQTtRQUpvQkEsdUJBQVdBLEdBQVhBLFdBQVdBO1FBTXBFQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQTtRQUVoQ0EsT0FBT0EsR0FBR0EsT0FBT0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFFdkJBLElBQUlBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBO1FBR1pBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQ3RDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxPQUFPQSxHQUFHQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN4Q0EsR0FBR0EsSUFBSUEsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbEJBLENBQUNBO1FBRURBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ2JBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBO2dCQUFFQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxHQUFHQSxDQUFDQTtRQUN6REEsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDTkEsSUFBSUEsR0FBR0EsR0FBR0EsQ0FBQ0EsR0FBR0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDM0JBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBO2dCQUFFQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUN4REEsQ0FBQ0E7UUFFREEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7SUFDZkEsQ0FBQ0E7SUFFTUYseUJBQW1CQSxHQUExQkEsVUFBMkJBLE1BQThCQSxFQUFFQSxNQUE4QkE7UUFDdkZHLEFBRUFBLGlEQUZpREE7UUFDakRBLGlCQUFpQkE7WUFDYkEsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFFZEEsSUFBSUEsS0FBS0EsR0FBR0EsQ0FBQ0EsRUFBRUEsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFFekJBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLE1BQU1BLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQ3ZDQSxLQUFLQSxJQUFJQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMvQkEsS0FBS0EsSUFBSUEsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDL0JBLEtBQUtBLElBQUlBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2pDQSxDQUFDQTtRQUVEQSxNQUFNQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxDQUFDQTtJQUNoRUEsQ0FBQ0E7SUFFTUgsc0JBQWdCQSxHQUF2QkEsVUFBd0JBLGFBQXFDQSxFQUFFQSxNQUE4QkEsRUFBRUEsQ0FBQ0E7UUFDOUZJLEFBQ0FBLDhCQUQ4QkE7WUFDMUJBLFNBQVNBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBQ3RCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxhQUFhQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQTtZQUMzQ0EsYUFBYUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsYUFBYUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsU0FBU0EsR0FBR0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbEVBLE1BQU1BLENBQUNBLGFBQWFBLENBQUNBO0lBQ3ZCQSxDQUFDQTtJQUVESixZQUFZQTtJQUNMQSxnQkFBVUEsR0FBakJBLFVBQWtCQSxNQUE4QkEsRUFBRUEsRUFBMEJBLEVBQUVBLENBQVNBO1FBQ3JGSyxBQUNBQSxZQURZQTtZQUNSQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUtaQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUNuQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDM0JBLEdBQUdBLElBQUlBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2ZBLENBQUNBO1FBRURBLEFBQ0FBLDJCQUQyQkE7UUFDM0JBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ2JBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBO2dCQUFFQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUM5REEsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDTkEsSUFBSUEsR0FBR0EsR0FBR0EsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFD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QSxDQUFDQSxDQUFDQTtRQUVsRkEsSUFBSUEsWUFBWUEsR0FBR0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFFOUJBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLFNBQVNBLEdBQUdBLENBQUNBLEVBQUVBLFNBQVNBLEdBQUdBLEtBQUtBLEVBQUVBLFNBQVNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQ3ZEQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxRQUFRQSxDQUFDQSxZQUFZQSxFQUFFQSxZQUFZQSxHQUFHQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNoRkEsWUFBWUEsSUFBSUEsU0FBU0EsQ0FBQ0E7UUFDNUJBLENBQUNBO1FBRURBLElBQUlBLENBQUNBLFNBQVNBLEdBQUdBLEtBQUtBLENBQUNBO0lBQ3pCQSxDQUFDQTtJQUVERCxtQkFBS0EsR0FBTEE7UUFDRUUsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsUUFBUUEsR0FBR0EsQ0FBQ0EsRUFBRUEsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsRUFBRUEsUUFBUUEsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDMURBLElBQUlBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLEdBQUdBLElBQUlBLFlBQVlBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLENBQUNBO1lBQ3BFQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtnQkFDdENBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBO1lBQzNCQSxDQUFDQTtZQUNEQSxLQUFLQSxDQUFDQSxPQUFPQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUN2QkEsQ0FB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TUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDN0RBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLFlBQVlBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLFVBQVVBLENBQUNBLENBQUNBO1FBQ3ZEQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUN2QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsSUFBSUEsWUFBWUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDdERBLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLElBQUlBLFlBQVlBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBQ3BEQSxJQUFJQSxDQUFDQSxVQUFVQSxHQUFHQSxnQkFBZ0JBLElBQUlBLElBQUlBLFlBQVlBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBRTNFQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxVQUFVQSxHQUFHQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSx1QkFBdUJBLENBQUNBLENBQUNBO1FBRXhGQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxXQUFXQSxDQUFDQSxPQUFPQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxFQUFFQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxjQUFjQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQTtRQUNuRkEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsV0FBV0EsRUFBRUEsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsY0FBY0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0E7SUFDckZBLENBQUNBO0lBSURELHlCQUFVQSxHQUFWQTtRQUNFRSxJQUFJQSxVQUFVQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQTtRQUV2Q0EsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDcERBLElBQUlBLENBQUNBLGVBQWVBLEdBQUdBLE1BQU1BLENBQUNBLFFBQVFBLENBQUNBLFVBQVVBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO1FBQzVEQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUU1Q0EsSUFBSUEsT0FBT0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDaEJBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQzVDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFHQSxPQUFPQSxDQUFDQSxDQUFDQSxVQUFVQSxDQUFDQTtRQUMzREEsQ0FBQ0E7UUFFREEsT0FBT0EsSUFBSUEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDOUJBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQzVDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFHQSxPQUFPQSxDQUFDQSxDQUFDQSxVQUFVQSxDQUFDQTtRQUM1REEsQ0FBQ0E7UUFFREEsT0FBT0EsSUFBSUEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDOUJBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQzVDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFHQSxPQUFPQSxDQUFDQSxDQUFDQSxVQUFVQSxDQUFDQTtRQUM5REEsQ0FBQ0E7UUFHREEsT0FBT0EsSUFBSUEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFJNUJBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQzVDQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLEdBQUdBLE9BQU9BLENBQUNBLENBQUNBLFVBQVVBLENBQUNBO1FBQ3JFQSxDQUFDQTtRQUNIQSxBQWFBQTs7Ozs7Ozs7O1dBSkdBO1lBSUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBO1FBR3pCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQTtZQUMvQkEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQSxtQkFBbUJBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBRTNFQSxBQUNBQSxvQ0FEb0NBO1FBQ3BDQSxLQUFLQSxDQUFDQSxnQkFBZ0JBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsRUFBRUEsSUFBSUEsQ0FBQ0EsWUFBWUEsRUFBRUEsSUFBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsQ0FBQ0E7UUFFeEZBLEFBQ0FBLHNCQURzQkE7UUFDdEJBLEtBQUtBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLENBQUNBLGdCQUFnQkEsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDekNBLEtBQUtBLENBQUNBLGNBQWNBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsRUFBRUEsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxDQUFDQTtRQUdwRUEsQUFDQUEsYUFEYUE7UUFDYkEsS0FBS0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsRUFBRUEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxFQUFFQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtRQU8xRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsS0FBS0EsR0FBR0EsQ0FBQ0EsRUFBRUEsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsRUFBRUEsS0FBS0EsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDeERBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBQzNCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxHQUFHQSxDQUFDQSxFQUFFQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxVQUFVQSxFQUFFQSxJQUFJQSxFQUFFQSxFQUFFQSxDQUFDQTtnQkFDekRBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO1lBQ3JGQSxDQUFDQTtRQUNIQSxDQUFDQTtJQUNIQSxDQUFDQTtJQTdHTUYsNEJBQXVCQSxHQUFHQSxDQUFDQSxDQUFDQTtJQThHckNBLFdBQUNBO0FBQURBLENBL0dBLEFBK0dDQSxJQUFBO0FBL0dZLFlBQUksR0FBSixJQStHWixDQUFBIiwiZmlsZSI6InNyYy9hcmNoaXRlY3QvTlRNLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG5ldHdvcmsgPSByZXF1aXJlKCcuLi9uZXR3b3JrJyk7XG5pbXBvcnQgdHJhaW5lciA9IHJlcXVpcmUoJy4uL3RyYWluZXInKTtcbmltcG9ydCBMYXllciA9IHJlcXVpcmUoJy4uL2xheWVyJyk7XG5pbXBvcnQgbmV1cm9uID0gcmVxdWlyZSgnLi4vbmV1cm9uJyk7XG5pbXBvcnQgU3luYXB0aWMgPSByZXF1aXJlKCcuLi9zeW5hcHRpYycpO1xuaW1wb3J0IFNxdWFzaCA9IHJlcXVpcmUoJy4uL3NxdWFzaCcpO1xuXG5leHBvcnQgY2xhc3MgVXRpbHMge1xuICBzdGF0aWMgc29mdE1heDxUIGV4dGVuZHMgU3luYXB0aWMuSU51bWVyaWNBcnJheT4oYXJyYXk6IFQsIHNoYXJwZW4gPSAxKTogVCB7XG4gICAgLy8gZm9yIGFsbCBpIOKIiCBhcnJheVxuICAgIC8vIHN1bSA9IOKIkSBhcnJheVtuXV5lXG4gICAgLy8gaSA9IMOuXmUgLyBzdW1cbiAgICAvLyB3aGVyZSB0aGUgcmVzdWx0IOKIkSBhcnJheVswLi5uXSA9IDFcblxuICAgIGlmICghYXJyYXkubGVuZ3RoKSByZXR1cm4gYXJyYXk7XG5cbiAgICBzaGFycGVuID0gc2hhcnBlbiB8fCAxO1xuXG4gICAgdmFyIHN1bSA9IDA7XG5cbiAgICAvLyBzdW0gPSDiiJEgYXJyYXlbbl1eZVxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgIGFycmF5W2ldID0gTWF0aC5leHAoc2hhcnBlbiAqIGFycmF5W2ldKTtcbiAgICAgIHN1bSArPSBhcnJheVtpXTtcbiAgICB9XG5cbiAgICBpZiAoc3VtICE9IDApIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIGFycmF5W2ldIC89IHN1bTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGRpdiA9IDEgLyBhcnJheS5sZW5ndGg7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSBhcnJheVtpXSA9IGRpdjtcbiAgICB9XG5cbiAgICByZXR1cm4gYXJyYXk7XG4gIH1cblxuICBzdGF0aWMgZ2V0Q29zaW5lU2ltaWxhcml0eShhcnJheUE6IFN5bmFwdGljLklOdW1lcmljQXJyYXksIGFycmF5QjogU3luYXB0aWMuSU51bWVyaWNBcnJheSk6IG51bWJlciB7XG4gICAgLy8gaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Db3NpbmVfc2ltaWxhcml0eVxuICAgIC8vIE5UTTogMy4zLjEgKDYpXG4gICAgdmFyIGRvdFByID0gMDtcblxuICAgIHZhciBhY3VtQSA9IDAsIGFjdW1CID0gMDtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXlBLmxlbmd0aDsgaSsrKSB7XG4gICAgICBkb3RQciArPSBhcnJheUFbaV0gKiBhcnJheUJbaV07XG4gICAgICBhY3VtQSArPSBhcnJheUFbaV0gKiBhcnJheUFbaV07XG4gICAgICBhY3VtQiArPSBhcnJheUJbaV0gKiBhcnJheUJbaV07XG4gICAgfVxuXG4gICAgcmV0dXJuIGRvdFByIC8gKE1hdGguc3FydChhY3VtQSkgKiBNYXRoLnNxcnQoYWN1bUIpICsgLjAwMDA1KTtcbiAgfVxuXG4gIHN0YXRpYyBpbnRlcnBvbGF0ZUFycmF5KG91dHB1dF9pbnB1dEE6IFN5bmFwdGljLklOdW1lcmljQXJyYXksIGlucHV0QjogU3luYXB0aWMuSU51bWVyaWNBcnJheSwgZykge1xuICAgIC8vIDMuMy4yIGZvY3VzIGJ5IGxvY2F0aW9uICg3KVxuICAgIHZhciBnSW52ZXJ0ZWQgPSAxIC0gZztcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG91dHB1dF9pbnB1dEEubGVuZ3RoOyBpKyspXG4gICAgICBvdXRwdXRfaW5wdXRBW2ldID0gb3V0cHV0X2lucHV0QVtpXSAqIGcgKyBnSW52ZXJ0ZWQgKiBpbnB1dEJbaV07XG4gICAgcmV0dXJuIG91dHB1dF9pbnB1dEE7XG4gIH1cbiAgXG4gIC8vIHdfc2hhcnBXblxuICBzdGF0aWMgc2hhcnBBcnJheShvdXRwdXQ6IFN5bmFwdGljLklOdW1lcmljQXJyYXksIHduOiBTeW5hcHRpYy5JTnVtZXJpY0FycmF5LCBZOiBudW1iZXIpIHtcbiAgICAvLyAzLjMuMiAoOSlcbiAgICB2YXIgc3VtID0gMDtcblxuICAgIC8vIOKIgCBhIOKIiCB3biDihpIgYSA9IGFeWVxuICAgIC8vIHN1bSA9IOKIkSBhXlkgXG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHduLmxlbmd0aDsgaSsrKSB7XG4gICAgICB3bltpXSA9IE1hdGgucG93KHduW2ldLCBZKTtcbiAgICAgIHN1bSArPSB3bltpXTtcbiAgICB9XG5cbiAgICAvLyDiiIAgYSDiiIggd24g4oaSIGEgPSBhXlkgLyBzdW1cbiAgICBpZiAoc3VtICE9IDApIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd24ubGVuZ3RoOyBpKyspIG91dHB1dFtpXSA9IHduW2ldIC8gc3VtO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgZGl2ID0gMSAvIHduLmxlbmd0aDtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd24ubGVuZ3RoOyBpKyspIG91dHB1dFtpXSA9IGRpdjtcbiAgICB9XG4gIH1cbiAgXG4gIC8vd25fc2hpZnRcbiAgc3RhdGljIHNjYWxhclNoaWZ0aW5nKHdnOiBTeW5hcHRpYy5JTnVtZXJpY0FycmF5LCBzaGlmdFNjYWxhcjogbnVtYmVyKSB7XG4gICAgLy8gd34gMy4zLjIgKDgpXG4gICAgdmFyIHNoaWZ0aW5ncyA9IG5ldyBGbG9hdDY0QXJyYXkod2cubGVuZ3RoKTtcbiAgICB2YXIgd24gPSBuZXcgRmxvYXQ2NEFycmF5KHdnLmxlbmd0aCk7XG5cbiAgICB2YXIgaW50UGFydCA9IHNoaWZ0U2NhbGFyIHwgMDtcbiAgICB2YXIgZGVjaW1hbFBhcnQgPSBzaGlmdFNjYWxhciAtIGludFBhcnQ7XG5cbiAgICBzaGlmdGluZ3NbaW50UGFydCAlIHNoaWZ0aW5ncy5sZW5ndGhdID0gMSAtIGRlY2ltYWxQYXJ0O1xuICAgIHNoaWZ0aW5nc1soaW50UGFydCArIDEpICUgc2hpZnRpbmdzLmxlbmd0aF0gPSBkZWNpbWFsUGFydDtcblxuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3bi5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGFjdW0gPSAwO1xuICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB3bi5sZW5ndGg7IGorKykge1xuICAgICAgICBpZiAoKGkgLSBqKSA8IDApXG4gICAgICAgICAgYWN1bSArPSB3Z1tqXSAqIHNoaWZ0aW5nc1tzaGlmdGluZ3MubGVuZ3RoIC0gTWF0aC5hYnMoaSAtIGopXTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgIGFjdW0gKz0gd2dbal0gKiBzaGlmdGluZ3NbKGkgLSBqKSAlIHNoaWZ0aW5ncy5sZW5ndGhdO1xuICAgICAgfVxuICAgICAgd25baV0gPSBhY3VtO1xuICAgIH1cblxuICAgIHJldHVybiB3bjtcbiAgfVxuXG4gIHN0YXRpYyB2ZWN0b3JTaGlmdGluZyh3ZzogRmxvYXQ2NEFycmF5LCBzaGlmdGluZ3M6IFN5bmFwdGljLklOdW1lcmljQXJyYXkpIHtcbiAgICAvLyB3fiAzLjMuMiAoOClcblxuICAgIHZhciB3biA9IG5ldyBGbG9hdDY0QXJyYXkod2cubGVuZ3RoKTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd24ubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBhY3VtID0gMDtcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgd24ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgaWYgKChpIC0gaikgPCAwKVxuICAgICAgICAgIGFjdW0gKz0gd2dbal0gKiBzaGlmdGluZ3Nbc2hpZnRpbmdzLmxlbmd0aCAtIE1hdGguYWJzKGkgLSBqKV07XG4gICAgICAgIGVsc2VcbiAgICAgICAgICBhY3VtICs9IHdnW2pdICogc2hpZnRpbmdzWyhpIC0gaikgJSBzaGlmdGluZ3MubGVuZ3RoXTtcbiAgICAgIH1cbiAgICAgIHduW2ldID0gYWN1bTtcbiAgICB9XG5cbiAgICB3Zy5zZXQod24pO1xuICB9XG59XG5cblxuXG5leHBvcnQgY2xhc3MgTlRNIGV4dGVuZHMgbmV0d29yay5OZXR3b3JrIHtcbiAgdHJhaW5lcjogdHJhaW5lci5UcmFpbmVyO1xuICBcbiAgZGF0YTogRmxvYXQ2NEFycmF5W107XG5cbiAgYmxvY2tXaWR0aDogbnVtYmVyO1xuICBibG9ja3M6IG51bWJlcjtcblxuICBoZWFkczogSGVhZFtdID0gbmV3IEFycmF5KCk7XG4gIFxuICBpbnB1dFZhbHVlczogRmxvYXQ2NEFycmF5O1xuICBcbiAgaW5wdXRMYXllcjogTGF5ZXIuTGF5ZXI7XG4gIGhpZGRlbkxheWVyOiBMYXllci5MYXllcjtcbiAgb3V0cHV0TGF5ZXI6IExheWVyLkxheWVyO1xuICBcbiAgZGlydHkgPSBmYWxzZTtcblxuICBjb25zdHJ1Y3RvcihpbnB1dHM6IG51bWJlciwgb3V0cHV0czogbnVtYmVyLCBtZW1CbG9ja3M6IG51bWJlciwgYmxvY2tXaWR0aDogbnVtYmVyLCBoZWFkczogbnVtYmVyLCBoaWRkZW5TaXplOiBudW1iZXIpIHtcbiAgICAvLyBidWlsZCB0aGUgbWVtb3J5XG4gICAgXG4gICAgc3VwZXIoKTtcbiAgICBcbiAgICB0aGlzLnRyYWluZXIgPSBuZXcgdHJhaW5lci5UcmFpbmVyKHRoaXMpO1xuICAgIFxuICAgIHRoaXMuYmxvY2tzID0gbWVtQmxvY2tzO1xuICAgIHRoaXMuYmxvY2tXaWR0aCA9IGJsb2NrV2lkdGg7XG5cbiAgICB0aGlzLmRhdGEgPSBuZXcgQXJyYXkodGhpcy5ibG9ja3MpO1xuXG4gICAgdGhpcy5jbGVhbigpO1xuICAgIFxuICAgIC8vIGJ1aWxkIHRoZSBuZXR3b3JrXG4gICAgXG4gICAgdmFyIGlucHV0TGVuZ3RoID0gaW5wdXRzICsgaGVhZHMgKiBtZW1CbG9ja3M7XG4gICAgXG4gICAgdGhpcy5pbnB1dFZhbHVlcyA9IG5ldyBGbG9hdDY0QXJyYXkoaW5wdXRMZW5ndGgpO1xuICAgIFxuICAgIHRoaXMubGF5ZXJzLmlucHV0ID0gdGhpcy5pbnB1dExheWVyID0gbmV3IExheWVyLkxheWVyKGlucHV0TGVuZ3RoKTtcbiAgICB0aGlzLmhpZGRlbkxheWVyID0gbmV3IExheWVyLkxheWVyKGhpZGRlblNpemUpO1xuICAgIHRoaXMubGF5ZXJzLm91dHB1dCA9IHRoaXMub3V0cHV0TGF5ZXIgPSBuZXcgTGF5ZXIuTGF5ZXIob3V0cHV0cyk7XG4gICAgXG4gICAgXG5cbiAgICB0aGlzLmlucHV0TGF5ZXIucHJvamVjdCh0aGlzLmhpZGRlbkxheWVyLCBMYXllci5MYXllci5jb25uZWN0aW9uVHlwZS5BTExfVE9fQUxMKTtcbiAgICB0aGlzLmhpZGRlbkxheWVyLnByb2plY3QodGhpcy5vdXRwdXRMYXllciwgTGF5ZXIuTGF5ZXIuY29ubmVjdGlvblR5cGUuQUxMX1RPX0FMTCk7XG4gICAgXG4gICAgdmFyIGlucHV0Q291bnRlciA9IGlucHV0cyAtIDE7XG4gICAgXG4gICAgZm9yICh2YXIgaGVhZEluZGV4ID0gMDsgaGVhZEluZGV4IDwgaGVhZHM7IGhlYWRJbmRleCsrKSB7XG4gICAgICB0aGlzLmFkZEhlYWQodGhpcy5pbnB1dFZhbHVlcy5zdWJhcnJheShpbnB1dENvdW50ZXIsIGlucHV0Q291bnRlciArIG1lbUJsb2NrcykpO1xuICAgICAgaW5wdXRDb3VudGVyICs9IG1lbUJsb2NrcztcbiAgICB9XG4gICAgXG4gICAgdGhpcy5vcHRpbWl6ZWQgPSBmYWxzZTtcbiAgfVxuICBcbiAgY2xlYW4oKXtcbiAgICBmb3IgKHZhciBsb2NhdGlvbiA9IDA7IGxvY2F0aW9uIDwgdGhpcy5ibG9ja3M7IGxvY2F0aW9uKyspIHtcbiAgICAgIHZhciBhcnJheSA9IHRoaXMuZGF0YVtsb2NhdGlvbl0gPSBuZXcgRmxvYXQ2NEFycmF5KHRoaXMuYmxvY2tXaWR0aCk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGFycmF5W2ldID0gTWF0aC5yYW5kb20oKTtcbiAgICAgIH1cbiAgICAgIFV0aWxzLnNvZnRNYXgoYXJyYXkpO1xuICAgIH1cbiAgICB0aGlzLmRpcnR5ID0gZmFsc2U7XG4gIH1cbiAgXG4gIGFjdGl2YXRlKGlucHV0OiBTeW5hcHRpYy5JTnVtZXJpY0FycmF5KXtcbiAgICB0aGlzLmlucHV0VmFsdWVzLnNldCg8YW55PmlucHV0KTtcbiAgICBcbiAgICB0aGlzLmlucHV0TGF5ZXIuYWN0aXZhdGUodGhpcy5pbnB1dFZhbHVlcyk7XG4gICAgdGhpcy5oaWRkZW5MYXllci5hY3RpdmF0ZSgpO1xuICAgIFxuICAgIHRoaXMuZG9UaW1lU3RlcCgpO1xuICAgIFxuICAgIHJldHVybiB0aGlzLm91dHB1dExheWVyLmFjdGl2YXRlKCk7XG4gIH1cbiAgXG4gIHByb3BhZ2F0ZShyYXRlOiBudW1iZXIsIHRhcmdldDogU3luYXB0aWMuSU51bWVyaWNBcnJheSl7XG4gICAgdGhpcy5vdXRwdXRMYXllci5wcm9wYWdhdGUocmF0ZSwgdGFyZ2V0KTtcbiAgICBmb3IodmFyIGkgPSB0aGlzLmhlYWRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKXtcbiAgICAgIHRoaXMuaGVhZHNbaV0ubGF5ZXIucHJvcGFnYXRlKHJhdGUpO1xuICAgIH1cbiAgICB0aGlzLmhpZGRlbkxheWVyLnByb3BhZ2F0ZShyYXRlKTtcbiAgICB0aGlzLmRpcnR5ID0gdHJ1ZTtcbiAgfVxuXG4gIGFkZEhlYWQoc3ViQXJyYXk6IEZsb2F0NjRBcnJheSk6IEhlYWQge1xuICAgIHZhciBoZWFkID0gbmV3IEhlYWQodGhpcywgc3ViQXJyYXkpO1xuICAgIHRoaXMuaGVhZHMucHVzaChoZWFkKTtcbiAgICByZXR1cm4gaGVhZDtcbiAgfVxuXG4gIGRvVGltZVN0ZXAoKSB7XG4gICAgdGhpcy5oZWFkcy5mb3JFYWNoKChoZWFkLCBoZWFkSW5kZXgpID0+IHtcbiAgICAgIGhlYWQuZG9UaW1lU3RlcCgpO1xuICAgIH0pO1xuICAgIFxuICAgIC8vIHBhcmFsbGVsaXphYmxlXG4gICAgdGhpcy5oZWFkcy5mb3JFYWNoKChoZWFkLCBoZWFkSW5kZXgpID0+IHtcbiAgICAgIHRoaXMuZG9FcmFzZShoZWFkLndfd2VpZ2h0aW5ncywgaGVhZC5lcmFzZUdhdGUpO1xuICAgIH0pO1xuICAgIFxuICAgIC8vIHBhcmFsbGVsaXphYmxlXG4gICAgdGhpcy5oZWFkcy5mb3JFYWNoKChoZWFkLCBoZWFkSW5kZXgpID0+IHtcbiAgICAgIHRoaXMuZG9BZGQoaGVhZC53X3dlaWdodGluZ3MsIGhlYWQuYWRkR2F0ZSk7XG4gICAgfSk7XG4gICAgXG4gICAgLy90aGlzLmRhdGEuZm9yRWFjaCgoZSkgPT4gZSA9IFV0aWxzLnNvZnRNYXgoZSkpXG4gIH1cblxuICBkb0FkZCh3OiBTeW5hcHRpYy5JTnVtZXJpY0FycmF5LCBhZGRHYXRlOiBTeW5hcHRpYy5JTnVtZXJpY0FycmF5KSB7XG4gICAgZm9yICh2YXIgbiA9IDA7IG4gPCB0aGlzLmJsb2NrczsgbisrKSB7XG4gICAgICB2YXIgTSA9IHRoaXMuZGF0YVtuXTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5ibG9ja1dpZHRoOyBpKyspIHtcbiAgICAgICAgTVtpXSArPSBhZGRHYXRlW25dICogd1tpXTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBkb0VyYXNlKHc6IFN5bmFwdGljLklOdW1lcmljQXJyYXksIGVyYXNlR2F0ZTogU3luYXB0aWMuSU51bWVyaWNBcnJheSkge1xuICAgIGZvciAodmFyIG4gPSAwOyBuIDwgdGhpcy5ibG9ja3M7IG4rKykge1xuICAgICAgdmFyIE0gPSB0aGlzLmRhdGFbbl07XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuYmxvY2tXaWR0aDsgaSsrKSB7XG4gICAgICAgIE1baV0gKj0gMSAtIGVyYXNlR2F0ZVtuXSAqIHdbaV07XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZVNoaWZ0KHNoaWZ0OiBGbG9hdDY0QXJyYXkpIHtcblxuICAgICAgICB2YXIgc3VtID0gMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaGlmdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgc3VtICs9IHNoaWZ0W2ldO1xuICAgICAgICB9XG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc2hpZnQubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIHNoaWZ0W2pdIC89IHN1bTtcbiAgICAgICAgfVxuICAgIH1cblxuZXhwb3J0IGNsYXNzIEhlYWQge1xuICBzdGF0aWMgQURESVRJT05BTF9JTlBVVF9WQUxVRVMgPSAzO1xuICBcbiAgbWVtb3J5OiBOVE07XG5cbiAgd193ZWlnaHRpbmdzOiBGbG9hdDY0QXJyYXk7XG4gIGVyYXNlR2F0ZTogRmxvYXQ2NEFycmF5O1xuICBhZGRHYXRlOiBGbG9hdDY0QXJyYXk7XG4gIGtfa2V5czogRmxvYXQ2NEFycmF5O1xuICBnX2ludGVycG9sYXRpb246IG51bWJlcjtcbiAgWV9mb2N1czogbnVtYmVyO1xuICBzX3NoaWZ0aW5nVmFsdWU6IG51bWJlciA9IG51bGw7XG4gIHNfc2hpZnRpbmdWZWN0b3I6IEZsb2F0NjRBcnJheTtcbiAgd2NfZm9jdXNlZFdlaWdodHM6IEZsb2F0NjRBcnJheTtcbiAgcmVhZFZlY3RvcjogRmxvYXQ2NEFycmF5O1xuICDDn19rZXlTdHJlbmd0aDogbnVtYmVyO1xuICBwcmV2Rm9jdXM6IG51bWJlciA9IDE7XG4gIFxuICBsYXllcjogTGF5ZXIuTGF5ZXI7XG5cbiAgY29uc3RydWN0b3IobWVtb3J5OiBOVE0sIGRlc3RpbmF0aW9uQXJyYXk/OiBGbG9hdDY0QXJyYXkpIHtcbiAgICB0aGlzLm1lbW9yeSA9IG1lbW9yeTtcbiAgICB0aGlzLndjX2ZvY3VzZWRXZWlnaHRzID0gbmV3IEZsb2F0NjRBcnJheSh0aGlzLm1lbW9yeS5ibG9ja3MpO1xuICAgIHRoaXMud193ZWlnaHRpbmdzID0gbmV3IEZsb2F0NjRBcnJheSh0aGlzLm1lbW9yeS5ibG9ja3MpO1xuICAgIHRoaXMuc19zaGlmdGluZ1ZlY3RvciA9IG5ldyBGbG9hdDY0QXJyYXkodGhpcy5tZW1vcnkuYmxvY2tzKTtcbiAgICB0aGlzLmtfa2V5cyA9IG5ldyBGbG9hdDY0QXJyYXkodGhpcy5tZW1vcnkuYmxvY2tXaWR0aCk7XG4gICAgdGhpcy7Dn19rZXlTdHJlbmd0aCA9IDA7XG4gICAgdGhpcy5lcmFzZUdhdGUgPSBuZXcgRmxvYXQ2NEFycmF5KHRoaXMubWVtb3J5LmJsb2Nrcyk7XG4gICAgdGhpcy5hZGRHYXRlID0gbmV3IEZsb2F0NjRBcnJheSh0aGlzLm1lbW9yeS5ibG9ja3MpO1xuICAgIHRoaXMucmVhZFZlY3RvciA9IGRlc3RpbmF0aW9uQXJyYXkgfHwgbmV3IEZsb2F0NjRBcnJheSh0aGlzLm1lbW9yeS5ibG9ja3MpO1xuICAgIFxuICAgIHRoaXMubGF5ZXIgPSBuZXcgTGF5ZXIuTGF5ZXIodGhpcy5tZW1vcnkuYmxvY2tXaWR0aCAqIDQgKyBIZWFkLkFERElUSU9OQUxfSU5QVVRfVkFMVUVTKTtcbiAgICBcbiAgICB0aGlzLm1lbW9yeS5oaWRkZW5MYXllci5wcm9qZWN0KHRoaXMubGF5ZXIsIExheWVyLkxheWVyLmNvbm5lY3Rpb25UeXBlLkFMTF9UT19BTEwpO1xuICAgIHRoaXMubGF5ZXIucHJvamVjdCh0aGlzLm1lbW9yeS5vdXRwdXRMYXllciwgTGF5ZXIuTGF5ZXIuY29ubmVjdGlvblR5cGUuQUxMX1RPX0FMTCk7XG4gIH1cbiAgXG4gIFxuXG4gIGRvVGltZVN0ZXAoKSB7XG4gICAgdmFyIGFjdGl2YXRpb24gPSB0aGlzLmxheWVyLmFjdGl2YXRlKCk7XG4gICAgXG4gICAgdGhpcy7Dn19rZXlTdHJlbmd0aCA9IFNxdWFzaC5TT0ZUUExVUyhhY3RpdmF0aW9uWzBdKTtcbiAgICB0aGlzLmdfaW50ZXJwb2xhdGlvbiA9IFNxdWFzaC5MT0dJU1RJQyhhY3RpdmF0aW9uWzFdLCB0cnVlKTtcbiAgICB0aGlzLllfZm9jdXMgPSBNYXRoLmV4cChhY3RpdmF0aW9uWzJdKSArIDEwO1xuICAgIFxuICAgIHZhciBzdGFydEF0ID0gMztcbiAgICBmb3IgKHZhciBrID0gMDsgayA8IHRoaXMua19rZXlzLmxlbmd0aDsgaysrKSB7XG4gICAgICB0aGlzLmtfa2V5c1trXSA9IHRoaXMubGF5ZXIubGlzdFtrICsgc3RhcnRBdF0uYWN0aXZhdGlvbjtcbiAgICB9XG4gICAgXG4gICAgc3RhcnRBdCArPSB0aGlzLmtfa2V5cy5sZW5ndGg7XG4gICAgZm9yICh2YXIgayA9IDA7IGsgPCB0aGlzLmtfa2V5cy5sZW5ndGg7IGsrKykge1xuICAgICAgdGhpcy5hZGRHYXRlW2tdID0gdGhpcy5sYXllci5saXN0W2sgKyBzdGFydEF0XS5kZXJpdmF0aXZlO1xuICAgIH1cbiAgIFxuICAgIHN0YXJ0QXQgKz0gdGhpcy5rX2tleXMubGVuZ3RoOyBcbiAgICBmb3IgKHZhciBrID0gMDsgayA8IHRoaXMua19rZXlzLmxlbmd0aDsgaysrKSB7XG4gICAgICB0aGlzLmVyYXNlR2F0ZVtrXSA9IHRoaXMubGF5ZXIubGlzdFtrICsgc3RhcnRBdF0uYWN0aXZhdGlvbjtcbiAgICB9XG4gICAgXG5cbiAgICBzdGFydEF0ICs9IHRoaXMua19rZXlzLmxlbmd0aDtcbiAgICBcbiAgICBcbiAgICAvL2lmKHRoaXMubWVtb3J5LmRpcnR5KXtcbiAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgdGhpcy5rX2tleXMubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgdGhpcy5zX3NoaWZ0aW5nVmVjdG9yW2tdID0gdGhpcy5sYXllci5saXN0W2sgKyBzdGFydEF0XS5hY3RpdmF0aW9uOyBcbiAgICAgIH1cbiAgICAvKn0gZWxzZSB7XG4gICAgICB0aGlzLnByZXZGb2N1cysrO1xuICAgICAgdGhpcy5wcmV2Rm9jdXMgPSB0aGlzLnByZXZGb2N1cyAlIHRoaXMua19rZXlzLmxlbmd0aDtcbiAgICAgIFxuICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCB0aGlzLmtfa2V5cy5sZW5ndGg7IGsrKykge1xuICAgICAgICB0aGlzLnNfc2hpZnRpbmdWZWN0b3Jba10gPSAwOyBcbiAgICAgIH1cbiAgICAgIFxuICAgICAgdGhpcy5zX3NoaWZ0aW5nVmVjdG9yW3RoaXMucHJldkZvY3VzXSA9IDE7IFxuICAgIH0qL1xuICAgIFxuICAgIFxuICAgIFxuICAgIHZhciBNID0gdGhpcy5tZW1vcnkuZGF0YTtcbiAgICBcbiAgICAvLyBmb2N1cyBieSBjb250ZW50LCBvYnRhaW5zIGFuIGFycmF5IG9mIHNpbWlsYXJpdHkgaW5kZXhlcyBmb3IgZWFjaCBtZW1vcnlCbG9ja1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgTS5sZW5ndGg7IGkrKylcbiAgICAgIHRoaXMud2NfZm9jdXNlZFdlaWdodHNbaV0gPSBVdGlscy5nZXRDb3NpbmVTaW1pbGFyaXR5KE1baV0sIHRoaXMua19rZXlzKTtcbiAgICBcbiAgICAvLyBmb2N1cyBieSBsb2NhdGlvbiAoaW50ZXJwb2xhdGlvbilcbiAgICBVdGlscy5pbnRlcnBvbGF0ZUFycmF5KHRoaXMud2NfZm9jdXNlZFdlaWdodHMsIHRoaXMud193ZWlnaHRpbmdzLCB0aGlzLmdfaW50ZXJwb2xhdGlvbik7XG4gICAgXG4gICAgLy8gY29udm9sdXRpb25hbCBzaGlmdFxuICAgIFV0aWxzLnNvZnRNYXgodGhpcy5zX3NoaWZ0aW5nVmVjdG9yLCAxMCk7XG4gICAgVXRpbHMudmVjdG9yU2hpZnRpbmcodGhpcy53Y19mb2N1c2VkV2VpZ2h0cywgdGhpcy5zX3NoaWZ0aW5nVmVjdG9yKTtcbiAgICBcbiAgICAgXG4gICAgLy8gc2hhcnBlbmluZ1xuICAgIFV0aWxzLnNoYXJwQXJyYXkodGhpcy53X3dlaWdodGluZ3MsIHRoaXMud2NfZm9jdXNlZFdlaWdodHMsIHRoaXMuWV9mb2N1cyk7XG4gICAgXG4gICAgLy8vIHdlIGdvdCB3dCFcbiAgICBcbiAgICAvLyBzaW5jZSDiiJEgdyA9IDEsIHdlIGhhdmUgdG8gc29mdG1heCB0aGUgYXJyYXlcbiAgICBcbiAgICAvLyByZWFkaW5nXG4gICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMubWVtb3J5LmJsb2NrczsgaW5kZXgrKykge1xuICAgICAgdGhpcy5yZWFkVmVjdG9yW2luZGV4XSA9IDA7XG4gICAgICBmb3IgKHZhciBjZWxsID0gMDsgY2VsbCA8IHRoaXMubWVtb3J5LmJsb2NrV2lkdGg7IGNlbGwrKykge1xuICAgICAgICB0aGlzLnJlYWRWZWN0b3JbaW5kZXhdICs9IHRoaXMubWVtb3J5LmRhdGFbaW5kZXhdW2NlbGxdICogdGhpcy53X3dlaWdodGluZ3NbaW5kZXhdO1xuICAgICAgfVxuICAgIH1cbiAgfVxufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==