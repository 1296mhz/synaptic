var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var network = require('../network');
var trainer = require('../trainer');
var Layer = require('../layer');
var Squash = require('../squash');
var Utils = (function () {
    function Utils() {
    }
    Utils.softMax = function (array, sharpen) {
        // for all i ∈ array
        // sum = ∑ array[n]^e
        // i = î^e / sum
        // where the result ∑ array[0..n] = 1
        if (sharpen === void 0) { sharpen = 1; }
        if (!array.length)
            return array;
        sharpen = sharpen || 1;
        var sum = 0;
        for (var i = 0; i < array.length; i++) {
            array[i] = Math.exp(sharpen * array[i]);
            sum += array[i];
        }
        if (sum != 0) {
            for (var i = 0; i < array.length; i++)
                array[i] /= sum;
        }
        else {
            var div = 1 / array.length;
            for (var i = 0; i < array.length; i++)
                array[i] = div;
        }
        return array;
    };
    Utils.getCosineSimilarity = function (arrayA, arrayB) {
        // http://en.wikipedia.org/wiki/Cosine_similarity
        // NTM: 3.3.1 (6)
        var dotPr = 0;
        var acumA = 0, acumB = 0;
        for (var i = 0; i < arrayA.length; i++) {
            dotPr += arrayA[i] * arrayB[i];
            acumA += arrayA[i] * arrayA[i];
            acumB += arrayB[i] * arrayB[i];
        }
        return dotPr / (Math.sqrt(acumA) * Math.sqrt(acumB) + .00005);
    };
    Utils.interpolateArray = function (output_inputA, inputB, g) {
        // 3.3.2 focus by location (7)
        var gInverted = 1 - g;
        for (var i = 0; i < output_inputA.length; i++)
            output_inputA[i] = output_inputA[i] * g + gInverted * inputB[i];
        return output_inputA;
    };
    // w_sharpWn
    Utils.sharpArray = function (output, wn, Y) {
        // 3.3.2 (9)
        var sum = 0;
        for (var i = 0; i < wn.length; i++) {
            wn[i] = Math.pow(wn[i], Y);
            sum += wn[i];
        }
        // ∀ a ∈ wn → a = a^Y / sum
        if (sum != 0) {
            for (var i = 0; i < wn.length; i++)
                output[i] = wn[i] / sum;
        }
        else {
            var div = 1 / wn.length;
            for (var i = 0; i < wn.length; i++)
                output[i] = div;
        }
    };
    //wn_shift
    Utils.scalarShifting = function (wg, shiftScalar) {
        // w~ 3.3.2 (8)
        var shiftings = new Float64Array(wg.length);
        var wn = new Float64Array(wg.length);
        var intPart = shiftScalar | 0;
        var decimalPart = shiftScalar - intPart;
        shiftings[intPart % shiftings.length] = 1 - decimalPart;
        shiftings[(intPart + 1) % shiftings.length] = decimalPart;
        for (var i = 0; i < wn.length; i++) {
            var acum = 0;
            for (var j = 0; j < wn.length; j++) {
                if ((i - j) < 0)
                    acum += wg[j] * shiftings[shiftings.length - Math.abs(i - j)];
                else
                    acum += wg[j] * shiftings[(i - j) % shiftings.length];
            }
            wn[i] = acum;
        }
        return wn;
    };
    Utils.vectorShifting = function (wg, shiftings) {
        // w~ 3.3.2 (8)
        var wn = new Float64Array(wg.length);
        for (var i = 0; i < wn.length; i++) {
            var acum = 0;
            for (var j = 0; j < wn.length; j++) {
                if ((i - j) < 0)
                    acum += wg[j] * shiftings[shiftings.length - Math.abs(i - j)];
                else
                    acum += wg[j] * shiftings[(i - j) % shiftings.length];
            }
            wn[i] = acum;
        }
        wg.set(wn);
    };
    return Utils;
})();
exports.Utils = Utils;
var NTM = (function (_super) {
    __extends(NTM, _super);
    function NTM(inputs, outputs, memBlocks, blockWidth, heads, hiddenSize) {
        // build the memory
        _super.call(this);
        this.heads = new Array();
        this.dirty = false;
        this.trainer = new trainer.Trainer(this);
        this.blocks = memBlocks;
        this.blockWidth = blockWidth;
        this.data = new Array(this.blocks);
        this.clean();
        // build the network
        var inputLength = inputs + heads * memBlocks;
        this.inputValues = new Float64Array(inputLength);
        this.layers.input = this.inputLayer = new Layer.Layer(inputLength);
        this.hiddenLayer = new Layer.Layer(hiddenSize);
        this.layers.output = this.outputLayer = new Layer.Layer(outputs);
        this.inputLayer.project(this.hiddenLayer, Layer.Layer.connectionType.ALL_TO_ALL);
        this.hiddenLayer.project(this.outputLayer, Layer.Layer.connectionType.ALL_TO_ALL);
        var inputCounter = inputs - 1;
        for (var headIndex = 0; headIndex < heads; headIndex++) {
            this.addHead(this.inputValues.subarray(inputCounter, inputCounter + memBlocks));
            inputCounter += memBlocks;
        }
        this.optimized = false;
    }
    NTM.prototype.clean = function () {
        for (var location = 0; location < this.blocks; location++) {
            var array = this.data[location] = new Float64Array(this.blockWidth);
            for (var i = 0; i < array.length; i++) {
                array[i] = Math.random();
            }
            Utils.softMax(array);
        }
        this.dirty = false;
    };
    NTM.prototype.activate = function (input) {
        this.inputValues.set(input);
        this.inputLayer.activate(this.inputValues);
        this.hiddenLayer.activate();
        this.doTimeStep();
        return this.outputLayer.activate();
    };
    NTM.prototype.propagate = function (rate, target) {
        this.outputLayer.propagate(rate, target);
        for (var i = this.heads.length - 1; i >= 0; i--) {
            this.heads[i].layer.propagate(rate);
        }
        this.hiddenLayer.propagate(rate);
        this.dirty = true;
    };
    NTM.prototype.addHead = function (subArray) {
        var head = new Head(this, subArray);
        this.heads.push(head);
        return head;
    };
    NTM.prototype.doTimeStep = function () {
        var _this = this;
        this.heads.forEach(function (head, headIndex) {
            head.doTimeStep();
        });
        // parallelizable
        this.heads.forEach(function (head, headIndex) {
            _this.doErase(head.w_weightings, head.eraseGate);
        });
        // parallelizable
        this.heads.forEach(function (head, headIndex) {
            _this.doAdd(head.w_weightings, head.addGate);
        });
        //this.data.forEach((e) => e = Utils.softMax(e))
    };
    NTM.prototype.doAdd = function (w, addGate) {
        for (var n = 0; n < this.blocks; n++) {
            var M = this.data[n];
            for (var i = 0; i < this.blockWidth; i++) {
                M[i] += addGate[n] * w[i];
            }
        }
    };
    NTM.prototype.doErase = function (w, eraseGate) {
        for (var n = 0; n < this.blocks; n++) {
            var M = this.data[n];
            for (var i = 0; i < this.blockWidth; i++) {
                M[i] *= 1 - eraseGate[n] * w[i];
            }
        }
    };
    return NTM;
})(network.Network);
exports.NTM = NTM;
function normalizeShift(shift) {
    var sum = 0;
    for (var i = 0; i < shift.length; i++) {
        sum += shift[i];
    }
    for (var j = 0; j < shift.length; j++) {
        shift[j] /= sum;
    }
}
var Head = (function () {
    function Head(memory, destinationArray) {
        this.s_shiftingValue = null;
        this.prevFocus = 1;
        this.memory = memory;
        this.wc_focusedWeights = new Float64Array(this.memory.blocks);
        this.w_weightings = new Float64Array(this.memory.blocks);
        this.s_shiftingVector = new Float64Array(this.memory.blocks);
        this.k_keys = new Float64Array(this.memory.blockWidth);
        this.ß_keyStrength = 0;
        this.eraseGate = new Float64Array(this.memory.blocks);
        this.addGate = new Float64Array(this.memory.blocks);
        this.readVector = destinationArray || new Float64Array(this.memory.blocks);
        this.layer = new Layer.Layer(this.memory.blockWidth * 4 + Head.ADDITIONAL_INPUT_VALUES);
        this.memory.hiddenLayer.project(this.layer, Layer.Layer.connectionType.ALL_TO_ALL);
        this.layer.project(this.memory.outputLayer, Layer.Layer.connectionType.ALL_TO_ALL);
    }
    Head.prototype.doTimeStep = function () {
        var activation = this.layer.activate();
        this.ß_keyStrength = Squash.SOFTPLUS(activation[0]);
        this.g_interpolation = Squash.LOGISTIC(activation[1], true);
        this.Y_focus = Math.exp(activation[2]) + 10;
        var startAt = 3;
        for (var k = 0; k < this.k_keys.length; k++) {
            this.k_keys[k] = this.layer.list[k + startAt].activation;
        }
        startAt += this.k_keys.length;
        for (var k = 0; k < this.k_keys.length; k++) {
            this.addGate[k] = this.layer.list[k + startAt].derivative;
        }
        startAt += this.k_keys.length;
        for (var k = 0; k < this.k_keys.length; k++) {
            this.eraseGate[k] = this.layer.list[k + startAt].activation;
        }
        startAt += this.k_keys.length;
        for (var k = 0; k < this.k_keys.length; k++) {
            this.s_shiftingVector[k] = this.layer.list[k + startAt].activation;
        }
        /*} else {
          this.prevFocus++;
          this.prevFocus = this.prevFocus % this.k_keys.length;
          
          for (var k = 0; k < this.k_keys.length; k++) {
            this.s_shiftingVector[k] = 0;
          }
          
          this.s_shiftingVector[this.prevFocus] = 1;
        }*/
        var M = this.memory.data;
        for (var i = 0; i < M.length; i++)
            this.wc_focusedWeights[i] = Utils.getCosineSimilarity(M[i], this.k_keys);
        // focus by location (interpolation)
        Utils.interpolateArray(this.wc_focusedWeights, this.w_weightings, this.g_interpolation);
        // convolutional shift
        Utils.softMax(this.s_shiftingVector, 10);
        Utils.vectorShifting(this.wc_focusedWeights, this.s_shiftingVector);
        // sharpening
        Utils.sharpArray(this.w_weightings, this.wc_focusedWeights, this.Y_focus);
        /// we got wt!
        // since ∑ w = 1, we have to softmax the array
        Utils.softMax(this.w_weightings);
        for (var index = 0; index < this.memory.blocks; index++) {
            this.readVector[index] = 0;
            for (var cell = 0; cell < this.memory.blockWidth; cell++) {
                this.readVector[index] += this.memory.data[index][cell] * this.w_weightings[index];
            }
        }
    };
    Head.ADDITIONAL_INPUT_VALUES = 3;
    return Head;
})();
exports.Head = Head;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcmNoaXRlY3QvTlRNLnRzIl0sIm5hbWVzIjpbIlV0aWxzIiwiVXRpbHMuY29uc3RydWN0b3IiLCJVdGlscy5zb2Z0TWF4IiwiVXRpbHMuZ2V0Q29zaW5lU2ltaWxhcml0eSIsIlV0aWxzLmludGVycG9sYXRlQXJyYXkiLCJVdGlscy5zaGFycEFycmF5IiwiVXRpbHMuc2NhbGFyU2hpZnRpbmciLCJVdGlscy52ZWN0b3JTaGlmdGluZyIsIk5UTSIsIk5UTS5jb25zdHJ1Y3RvciIsIk5UTS5jbGVhbiIsIk5UTS5hY3RpdmF0ZSIsIk5UTS5wcm9wYWdhdGUiLCJOVE0uYWRkSGVhZCIsIk5UTS5kb1RpbWVTdGVwIiwiTlRNLmRvQWRkIiwiTlRNLmRvRXJhc2UiLCJub3JtYWxpemVTaGlmdCIsIkhlYWQiLCJIZWFkLmNvbnN0cnVjdG9yIiwiSGVhZC5kb1RpbWVTdGVwIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFPLE9BQU8sV0FBVyxZQUFZLENBQUMsQ0FBQztBQUN2QyxJQUFPLE9BQU8sV0FBVyxZQUFZLENBQUMsQ0FBQztBQUN2QyxJQUFPLEtBQUssV0FBVyxVQUFVLENBQUMsQ0FBQztBQUduQyxJQUFPLE1BQU0sV0FBVyxXQUFXLENBQUMsQ0FBQztBQUVyQyxJQUFhLEtBQUs7SUFBbEJBLFNBQWFBLEtBQUtBO0lBd0hsQkMsQ0FBQ0E7SUF2SFFELGFBQU9BLEdBQWRBLFVBQWlEQSxLQUFRQSxFQUFFQSxPQUFXQTtRQUNwRUUsb0JBQW9CQTtRQUNwQkEscUJBQXFCQTtRQUNyQkEsZ0JBQWdCQTtRQUNoQkEscUNBQXFDQTtRQUpvQkEsdUJBQVdBLEdBQVhBLFdBQVdBO1FBTXBFQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQTtRQUVoQ0EsT0FBT0EsR0FBR0EsT0FBT0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFFdkJBLElBQUlBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBO1FBR1pBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQ3RDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxPQUFPQSxHQUFHQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN4Q0EsR0FBR0EsSUFBSUEsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbEJBLENBQUNBO1FBRURBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ2JBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBO2dCQUFFQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxHQUFHQSxDQUFDQTtRQUN6REEsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDTkEsSUFBSUEsR0FBR0EsR0FBR0EsQ0FBQ0EsR0FBR0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDM0JBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLEtBQUtBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBO2dCQUFFQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUN4REEsQ0FBQ0E7UUFFREEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0E7SUFDZkEsQ0FBQ0E7SUFFTUYseUJBQW1CQSxHQUExQkEsVUFBMkJBLE1BQThCQSxFQUFFQSxNQUE4QkE7UUFDdkZHLEFBRUFBLGlEQUZpREE7UUFDakRBLGlCQUFpQkE7WUFDYkEsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFFZEEsSUFBSUEsS0FBS0EsR0FBR0EsQ0FBQ0EsRUFBRUEsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFFekJBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLE1BQU1BLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQ3ZDQSxLQUFLQSxJQUFJQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMvQkEsS0FBS0EsSUFBSUEsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDL0JBLEtBQUtBLElBQUlBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2pDQSxDQUFDQTtRQUVEQSxNQUFNQSxDQUFDQSxLQUFLQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxNQUFNQSxDQUFDQSxDQUFDQTtJQUNoRUEsQ0FBQ0E7SUFFTUgsc0JBQWdCQSxHQUF2QkEsVUFBd0JBLGFBQXFDQSxFQUFFQSxNQUE4QkEsRUFBRUEsQ0FBQ0E7UUFDOUZJLEFBQ0FBLDhCQUQ4QkE7WUFDMUJBLFNBQVNBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBQ3RCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxhQUFhQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQTtZQUMzQ0EsYUFBYUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsYUFBYUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsU0FBU0EsR0FBR0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbEVBLE1BQU1BLENBQUNBLGFBQWFBLENBQUNBO0lBQ3ZCQSxDQUFDQTtJQUVESixZQUFZQTtJQUNMQSxnQkFBVUEsR0FBakJBLFVBQWtCQSxNQUE4QkEsRUFBRUEsRUFBMEJBLEVBQUVBLENBQVNBO1FBQ3JGSyxBQUNBQSxZQURZQTtZQUNSQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUtaQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUNuQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDM0JBLEdBQUdBLElBQUlBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2ZBLENBQUNBO1FBRURBLEFBQ0FBLDJCQUQyQkE7UUFDM0JBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ2JBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBO2dCQUFFQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUM5REEsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDTkEsSUFBSUEsR0FBR0EsR0FBR0EsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFD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QSxDQUFDQSxDQUFDQTtRQUVsRkEsSUFBSUEsWUFBWUEsR0FBR0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFFOUJBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLFNBQVNBLEdBQUdBLENBQUNBLEVBQUVBLFNBQVNBLEdBQUdBLEtBQUtBLEVBQUVBLFNBQVNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQ3ZEQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxRQUFRQSxDQUFDQSxZQUFZQSxFQUFFQSxZQUFZQSxHQUFHQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNoRkEsWUFBWUEsSUFBSUEsU0FBU0EsQ0FBQ0E7UUFDNUJBLENBQUNBO1FBRURBLElBQUlBLENBQUNBLFNBQVNBLEdBQUdBLEtBQUtBLENBQUNBO0lBQ3pCQSxDQUFDQTtJQUVERCxtQkFBS0EsR0FBTEE7UUFDRUUsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsUUFBUUEsR0FBR0EsQ0FBQ0EsRUFBRUEsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsRUFBRUEsUUFBUUEsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDMURBLElBQUlBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLEdBQUdBLElBQUlBLFlBQVlBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLENBQUNBO1lBQ3BFQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtnQkFDdENBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBO1lBQzNCQSxDQUFDQTtZQUNEQSxLQUFLQSxDQUFDQSxPQUFPQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUN2QkEsQ0FB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TUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDN0RBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLFlBQVlBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLFVBQVVBLENBQUNBLENBQUNBO1FBQ3ZEQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUN2QkEsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsSUFBSUEsWUFBWUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDdERBLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLElBQUlBLFlBQVlBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBQ3BEQSxJQUFJQSxDQUFDQSxVQUFVQSxHQUFHQSxnQkFBZ0JBLElBQUlBLElBQUlBLFlBQVlBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBRTNFQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxVQUFVQSxHQUFHQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSx1QkFBdUJBLENBQUNBLENBQUNBO1FBRXhGQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxXQUFXQSxDQUFDQSxPQUFPQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxFQUFFQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxjQUFjQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQTtRQUNuRkEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsV0FBV0EsRUFBRUEsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsY0FBY0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0E7SUFDckZBLENBQUNBO0lBSURELHlCQUFVQSxHQUFWQTtRQUNFRSxJQUFJQSxVQUFVQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQTtRQUV2Q0EsSUFBSUEsQ0FBQ0EsYUFBYUEsR0FBR0EsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDcERBLElBQUlBLENBQUNBLGVBQWVBLEdBQUdBLE1BQU1BLENBQUNBLFFBQVFBLENBQUNBLFVBQVVBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO1FBQzVEQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUU1Q0EsSUFBSUEsT0FBT0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDaEJBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQzVDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFHQSxPQUFPQSxDQUFDQSxDQUFDQSxVQUFVQSxDQUFDQTtRQUMzREEsQ0FBQ0E7UUFFREEsT0FBT0EsSUFBSUEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDOUJBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQzVDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFHQSxPQUFPQSxDQUFDQSxDQUFDQSxVQUFVQSxDQUFDQTtRQUM1REEsQ0FBQ0E7UUFFREEsT0FBT0EsSUFBSUEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDOUJBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQzVDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxHQUFHQSxPQUFPQSxDQUFDQSxDQUFDQSxVQUFVQSxDQUFDQTtRQUM5REEsQ0FBQ0E7UUFHREEsT0FBT0EsSUFBSUEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFJNUJBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO1lBQzVDQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLEdBQUdBLE9BQU9BLENBQUNBLENBQUNBLFVBQVVBLENBQUNBO1FBQ3JFQSxDQUFDQTtRQUNIQSxBQWFBQTs7Ozs7Ozs7O1dBSkdBO1lBSUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBO1FBR3pCQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQTtZQUMvQkEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxLQUFLQSxDQUFDQSxtQkFBbUJBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLEVBQUVBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBRTNFQSxBQUNBQSxvQ0FEb0NBO1FBQ3BDQSxLQUFLQSxDQUFDQSxnQkFBZ0JBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsRUFBRUEsSUFBSUEsQ0FBQ0EsWUFBWUEsRUFBRUEsSUFBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsQ0FBQ0E7UUFFeEZBLEFBQ0FBLHNCQURzQkE7UUFDdEJBLEtBQUtBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLENBQUNBLGdCQUFnQkEsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDekNBLEtBQUtBLENBQUNBLGNBQWNBLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsRUFBRUEsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxDQUFDQTtRQUdwRUEsQUFDQUEsYUFEYUE7UUFDYkEsS0FBS0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsRUFBRUEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxFQUFFQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtRQUUxRUEsQUFHQUEsY0FIY0E7UUFFZEEsOENBQThDQTtRQUM5Q0EsS0FBS0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsQ0FBQ0E7UUFHakNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEtBQUtBLEdBQUdBLENBQUNBLEVBQUVBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE1BQU1BLEVBQUVBLEtBQUtBLEVBQUVBLEVBQUVBLENBQUNBO1lBQ3hEQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUMzQkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsR0FBR0EsQ0FBQ0EsRUFBRUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsVUFBVUEsRUFBRUEsSUFBSUEsRUFBRUEsRUFBRUEsQ0FBQ0E7Z0JBQ3pEQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxZQUFZQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtZQUNyRkEsQ0FBQ0E7UUFDSEEsQ0FBQ0E7SUFDSEEsQ0FBQ0E7SUE5R01GLDRCQUF1QkEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7SUErR3JDQSxXQUFDQTtBQUFEQSxDQWhIQSxBQWdIQ0EsSUFBQTtBQWhIWSxZQUFJLEdBQUosSUFnSFosQ0FBQSIsImZpbGUiOiJzcmMvYXJjaGl0ZWN0L05UTS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBuZXR3b3JrID0gcmVxdWlyZSgnLi4vbmV0d29yaycpO1xuaW1wb3J0IHRyYWluZXIgPSByZXF1aXJlKCcuLi90cmFpbmVyJyk7XG5pbXBvcnQgTGF5ZXIgPSByZXF1aXJlKCcuLi9sYXllcicpO1xuaW1wb3J0IG5ldXJvbiA9IHJlcXVpcmUoJy4uL25ldXJvbicpO1xuaW1wb3J0IFN5bmFwdGljID0gcmVxdWlyZSgnLi4vc3luYXB0aWMnKTtcbmltcG9ydCBTcXVhc2ggPSByZXF1aXJlKCcuLi9zcXVhc2gnKTtcblxuZXhwb3J0IGNsYXNzIFV0aWxzIHtcbiAgc3RhdGljIHNvZnRNYXg8VCBleHRlbmRzIFN5bmFwdGljLklOdW1lcmljQXJyYXk+KGFycmF5OiBULCBzaGFycGVuID0gMSk6IFQge1xuICAgIC8vIGZvciBhbGwgaSDiiIggYXJyYXlcbiAgICAvLyBzdW0gPSDiiJEgYXJyYXlbbl1eZVxuICAgIC8vIGkgPSDDrl5lIC8gc3VtXG4gICAgLy8gd2hlcmUgdGhlIHJlc3VsdCDiiJEgYXJyYXlbMC4ubl0gPSAxXG5cbiAgICBpZiAoIWFycmF5Lmxlbmd0aCkgcmV0dXJuIGFycmF5O1xuXG4gICAgc2hhcnBlbiA9IHNoYXJwZW4gfHwgMTtcblxuICAgIHZhciBzdW0gPSAwO1xuXG4gICAgLy8gc3VtID0g4oiRIGFycmF5W25dXmVcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBhcnJheVtpXSA9IE1hdGguZXhwKHNoYXJwZW4gKiBhcnJheVtpXSk7XG4gICAgICBzdW0gKz0gYXJyYXlbaV07XG4gICAgfVxuXG4gICAgaWYgKHN1bSAhPSAwKSB7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSBhcnJheVtpXSAvPSBzdW07XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBkaXYgPSAxIC8gYXJyYXkubGVuZ3RoO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykgYXJyYXlbaV0gPSBkaXY7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFycmF5O1xuICB9XG5cbiAgc3RhdGljIGdldENvc2luZVNpbWlsYXJpdHkoYXJyYXlBOiBTeW5hcHRpYy5JTnVtZXJpY0FycmF5LCBhcnJheUI6IFN5bmFwdGljLklOdW1lcmljQXJyYXkpOiBudW1iZXIge1xuICAgIC8vIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ29zaW5lX3NpbWlsYXJpdHlcbiAgICAvLyBOVE06IDMuMy4xICg2KVxuICAgIHZhciBkb3RQciA9IDA7XG5cbiAgICB2YXIgYWN1bUEgPSAwLCBhY3VtQiA9IDA7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5QS5sZW5ndGg7IGkrKykge1xuICAgICAgZG90UHIgKz0gYXJyYXlBW2ldICogYXJyYXlCW2ldO1xuICAgICAgYWN1bUEgKz0gYXJyYXlBW2ldICogYXJyYXlBW2ldO1xuICAgICAgYWN1bUIgKz0gYXJyYXlCW2ldICogYXJyYXlCW2ldO1xuICAgIH1cblxuICAgIHJldHVybiBkb3RQciAvIChNYXRoLnNxcnQoYWN1bUEpICogTWF0aC5zcXJ0KGFjdW1CKSArIC4wMDAwNSk7XG4gIH1cblxuICBzdGF0aWMgaW50ZXJwb2xhdGVBcnJheShvdXRwdXRfaW5wdXRBOiBTeW5hcHRpYy5JTnVtZXJpY0FycmF5LCBpbnB1dEI6IFN5bmFwdGljLklOdW1lcmljQXJyYXksIGcpIHtcbiAgICAvLyAzLjMuMiBmb2N1cyBieSBsb2NhdGlvbiAoNylcbiAgICB2YXIgZ0ludmVydGVkID0gMSAtIGc7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvdXRwdXRfaW5wdXRBLmxlbmd0aDsgaSsrKVxuICAgICAgb3V0cHV0X2lucHV0QVtpXSA9IG91dHB1dF9pbnB1dEFbaV0gKiBnICsgZ0ludmVydGVkICogaW5wdXRCW2ldO1xuICAgIHJldHVybiBvdXRwdXRfaW5wdXRBO1xuICB9XG4gIFxuICAvLyB3X3NoYXJwV25cbiAgc3RhdGljIHNoYXJwQXJyYXkob3V0cHV0OiBTeW5hcHRpYy5JTnVtZXJpY0FycmF5LCB3bjogU3luYXB0aWMuSU51bWVyaWNBcnJheSwgWTogbnVtYmVyKSB7XG4gICAgLy8gMy4zLjIgKDkpXG4gICAgdmFyIHN1bSA9IDA7XG5cbiAgICAvLyDiiIAgYSDiiIggd24g4oaSIGEgPSBhXllcbiAgICAvLyBzdW0gPSDiiJEgYV5ZIFxuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3bi5sZW5ndGg7IGkrKykge1xuICAgICAgd25baV0gPSBNYXRoLnBvdyh3bltpXSwgWSk7XG4gICAgICBzdW0gKz0gd25baV07XG4gICAgfVxuXG4gICAgLy8g4oiAIGEg4oiIIHduIOKGkiBhID0gYV5ZIC8gc3VtXG4gICAgaWYgKHN1bSAhPSAwKSB7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHduLmxlbmd0aDsgaSsrKSBvdXRwdXRbaV0gPSB3bltpXSAvIHN1bTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGRpdiA9IDEgLyB3bi5sZW5ndGg7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHduLmxlbmd0aDsgaSsrKSBvdXRwdXRbaV0gPSBkaXY7XG4gICAgfVxuICB9XG4gIFxuICAvL3duX3NoaWZ0XG4gIHN0YXRpYyBzY2FsYXJTaGlmdGluZyh3ZzogU3luYXB0aWMuSU51bWVyaWNBcnJheSwgc2hpZnRTY2FsYXI6IG51bWJlcikge1xuICAgIC8vIHd+IDMuMy4yICg4KVxuICAgIHZhciBzaGlmdGluZ3MgPSBuZXcgRmxvYXQ2NEFycmF5KHdnLmxlbmd0aCk7XG4gICAgdmFyIHduID0gbmV3IEZsb2F0NjRBcnJheSh3Zy5sZW5ndGgpO1xuXG4gICAgdmFyIGludFBhcnQgPSBzaGlmdFNjYWxhciB8IDA7XG4gICAgdmFyIGRlY2ltYWxQYXJ0ID0gc2hpZnRTY2FsYXIgLSBpbnRQYXJ0O1xuXG4gICAgc2hpZnRpbmdzW2ludFBhcnQgJSBzaGlmdGluZ3MubGVuZ3RoXSA9IDEgLSBkZWNpbWFsUGFydDtcbiAgICBzaGlmdGluZ3NbKGludFBhcnQgKyAxKSAlIHNoaWZ0aW5ncy5sZW5ndGhdID0gZGVjaW1hbFBhcnQ7XG5cblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd24ubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBhY3VtID0gMDtcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgd24ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgaWYgKChpIC0gaikgPCAwKVxuICAgICAgICAgIGFjdW0gKz0gd2dbal0gKiBzaGlmdGluZ3Nbc2hpZnRpbmdzLmxlbmd0aCAtIE1hdGguYWJzKGkgLSBqKV07XG4gICAgICAgIGVsc2VcbiAgICAgICAgICBhY3VtICs9IHdnW2pdICogc2hpZnRpbmdzWyhpIC0gaikgJSBzaGlmdGluZ3MubGVuZ3RoXTtcbiAgICAgIH1cbiAgICAgIHduW2ldID0gYWN1bTtcbiAgICB9XG5cbiAgICByZXR1cm4gd247XG4gIH1cblxuICBzdGF0aWMgdmVjdG9yU2hpZnRpbmcod2c6IEZsb2F0NjRBcnJheSwgc2hpZnRpbmdzOiBTeW5hcHRpYy5JTnVtZXJpY0FycmF5KSB7XG4gICAgLy8gd34gMy4zLjIgKDgpXG5cbiAgICB2YXIgd24gPSBuZXcgRmxvYXQ2NEFycmF5KHdnLmxlbmd0aCk7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHduLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgYWN1bSA9IDA7XG4gICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHduLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIGlmICgoaSAtIGopIDwgMClcbiAgICAgICAgICBhY3VtICs9IHdnW2pdICogc2hpZnRpbmdzW3NoaWZ0aW5ncy5sZW5ndGggLSBNYXRoLmFicyhpIC0gaildO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgYWN1bSArPSB3Z1tqXSAqIHNoaWZ0aW5nc1soaSAtIGopICUgc2hpZnRpbmdzLmxlbmd0aF07XG4gICAgICB9XG4gICAgICB3bltpXSA9IGFjdW07XG4gICAgfVxuXG4gICAgd2cuc2V0KHduKTtcbiAgfVxufVxuXG5cblxuZXhwb3J0IGNsYXNzIE5UTSBleHRlbmRzIG5ldHdvcmsuTmV0d29yayB7XG4gIHRyYWluZXI6IHRyYWluZXIuVHJhaW5lcjtcbiAgXG4gIGRhdGE6IEZsb2F0NjRBcnJheVtdO1xuXG4gIGJsb2NrV2lkdGg6IG51bWJlcjtcbiAgYmxvY2tzOiBudW1iZXI7XG5cbiAgaGVhZHM6IEhlYWRbXSA9IG5ldyBBcnJheSgpO1xuICBcbiAgaW5wdXRWYWx1ZXM6IEZsb2F0NjRBcnJheTtcbiAgXG4gIGlucHV0TGF5ZXI6IExheWVyLkxheWVyO1xuICBoaWRkZW5MYXllcjogTGF5ZXIuTGF5ZXI7XG4gIG91dHB1dExheWVyOiBMYXllci5MYXllcjtcbiAgXG4gIGRpcnR5ID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IoaW5wdXRzOiBudW1iZXIsIG91dHB1dHM6IG51bWJlciwgbWVtQmxvY2tzOiBudW1iZXIsIGJsb2NrV2lkdGg6IG51bWJlciwgaGVhZHM6IG51bWJlciwgaGlkZGVuU2l6ZTogbnVtYmVyKSB7XG4gICAgLy8gYnVpbGQgdGhlIG1lbW9yeVxuICAgIFxuICAgIHN1cGVyKCk7XG4gICAgXG4gICAgdGhpcy50cmFpbmVyID0gbmV3IHRyYWluZXIuVHJhaW5lcih0aGlzKTtcbiAgICBcbiAgICB0aGlzLmJsb2NrcyA9IG1lbUJsb2NrcztcbiAgICB0aGlzLmJsb2NrV2lkdGggPSBibG9ja1dpZHRoO1xuXG4gICAgdGhpcy5kYXRhID0gbmV3IEFycmF5KHRoaXMuYmxvY2tzKTtcblxuICAgIHRoaXMuY2xlYW4oKTtcbiAgICBcbiAgICAvLyBidWlsZCB0aGUgbmV0d29ya1xuICAgIFxuICAgIHZhciBpbnB1dExlbmd0aCA9IGlucHV0cyArIGhlYWRzICogbWVtQmxvY2tzO1xuICAgIFxuICAgIHRoaXMuaW5wdXRWYWx1ZXMgPSBuZXcgRmxvYXQ2NEFycmF5KGlucHV0TGVuZ3RoKTtcbiAgICBcbiAgICB0aGlzLmxheWVycy5pbnB1dCA9IHRoaXMuaW5wdXRMYXllciA9IG5ldyBMYXllci5MYXllcihpbnB1dExlbmd0aCk7XG4gICAgdGhpcy5oaWRkZW5MYXllciA9IG5ldyBMYXllci5MYXllcihoaWRkZW5TaXplKTtcbiAgICB0aGlzLmxheWVycy5vdXRwdXQgPSB0aGlzLm91dHB1dExheWVyID0gbmV3IExheWVyLkxheWVyKG91dHB1dHMpO1xuICAgIFxuICAgIFxuXG4gICAgdGhpcy5pbnB1dExheWVyLnByb2plY3QodGhpcy5oaWRkZW5MYXllciwgTGF5ZXIuTGF5ZXIuY29ubmVjdGlvblR5cGUuQUxMX1RPX0FMTCk7XG4gICAgdGhpcy5oaWRkZW5MYXllci5wcm9qZWN0KHRoaXMub3V0cHV0TGF5ZXIsIExheWVyLkxheWVyLmNvbm5lY3Rpb25UeXBlLkFMTF9UT19BTEwpO1xuICAgIFxuICAgIHZhciBpbnB1dENvdW50ZXIgPSBpbnB1dHMgLSAxO1xuICAgIFxuICAgIGZvciAodmFyIGhlYWRJbmRleCA9IDA7IGhlYWRJbmRleCA8IGhlYWRzOyBoZWFkSW5kZXgrKykge1xuICAgICAgdGhpcy5hZGRIZWFkKHRoaXMuaW5wdXRWYWx1ZXMuc3ViYXJyYXkoaW5wdXRDb3VudGVyLCBpbnB1dENvdW50ZXIgKyBtZW1CbG9ja3MpKTtcbiAgICAgIGlucHV0Q291bnRlciArPSBtZW1CbG9ja3M7XG4gICAgfVxuICAgIFxuICAgIHRoaXMub3B0aW1pemVkID0gZmFsc2U7XG4gIH1cbiAgXG4gIGNsZWFuKCl7XG4gICAgZm9yICh2YXIgbG9jYXRpb24gPSAwOyBsb2NhdGlvbiA8IHRoaXMuYmxvY2tzOyBsb2NhdGlvbisrKSB7XG4gICAgICB2YXIgYXJyYXkgPSB0aGlzLmRhdGFbbG9jYXRpb25dID0gbmV3IEZsb2F0NjRBcnJheSh0aGlzLmJsb2NrV2lkdGgpO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgICBhcnJheVtpXSA9IE1hdGgucmFuZG9tKCk7XG4gICAgICB9XG4gICAgICBVdGlscy5zb2Z0TWF4KGFycmF5KTtcbiAgICB9XG4gICAgdGhpcy5kaXJ0eSA9IGZhbHNlO1xuICB9XG4gIFxuICBhY3RpdmF0ZShpbnB1dDogU3luYXB0aWMuSU51bWVyaWNBcnJheSl7XG4gICAgdGhpcy5pbnB1dFZhbHVlcy5zZXQoPGFueT5pbnB1dCk7XG4gICAgXG4gICAgdGhpcy5pbnB1dExheWVyLmFjdGl2YXRlKHRoaXMuaW5wdXRWYWx1ZXMpO1xuICAgIHRoaXMuaGlkZGVuTGF5ZXIuYWN0aXZhdGUoKTtcbiAgICBcbiAgICB0aGlzLmRvVGltZVN0ZXAoKTtcbiAgICBcbiAgICByZXR1cm4gdGhpcy5vdXRwdXRMYXllci5hY3RpdmF0ZSgpO1xuICB9XG4gIFxuICBwcm9wYWdhdGUocmF0ZTogbnVtYmVyLCB0YXJnZXQ6IFN5bmFwdGljLklOdW1lcmljQXJyYXkpe1xuICAgIHRoaXMub3V0cHV0TGF5ZXIucHJvcGFnYXRlKHJhdGUsIHRhcmdldCk7XG4gICAgZm9yKHZhciBpID0gdGhpcy5oZWFkcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSl7XG4gICAgICB0aGlzLmhlYWRzW2ldLmxheWVyLnByb3BhZ2F0ZShyYXRlKTtcbiAgICB9XG4gICAgdGhpcy5oaWRkZW5MYXllci5wcm9wYWdhdGUocmF0ZSk7XG4gICAgdGhpcy5kaXJ0eSA9IHRydWU7XG4gIH1cblxuICBhZGRIZWFkKHN1YkFycmF5OiBGbG9hdDY0QXJyYXkpOiBIZWFkIHtcbiAgICB2YXIgaGVhZCA9IG5ldyBIZWFkKHRoaXMsIHN1YkFycmF5KTtcbiAgICB0aGlzLmhlYWRzLnB1c2goaGVhZCk7XG4gICAgcmV0dXJuIGhlYWQ7XG4gIH1cblxuICBkb1RpbWVTdGVwKCkge1xuICAgIHRoaXMuaGVhZHMuZm9yRWFjaCgoaGVhZCwgaGVhZEluZGV4KSA9PiB7XG4gICAgICBoZWFkLmRvVGltZVN0ZXAoKTtcbiAgICB9KTtcbiAgICBcbiAgICAvLyBwYXJhbGxlbGl6YWJsZVxuICAgIHRoaXMuaGVhZHMuZm9yRWFjaCgoaGVhZCwgaGVhZEluZGV4KSA9PiB7XG4gICAgICB0aGlzLmRvRXJhc2UoaGVhZC53X3dlaWdodGluZ3MsIGhlYWQuZXJhc2VHYXRlKTtcbiAgICB9KTtcbiAgICBcbiAgICAvLyBwYXJhbGxlbGl6YWJsZVxuICAgIHRoaXMuaGVhZHMuZm9yRWFjaCgoaGVhZCwgaGVhZEluZGV4KSA9PiB7XG4gICAgICB0aGlzLmRvQWRkKGhlYWQud193ZWlnaHRpbmdzLCBoZWFkLmFkZEdhdGUpO1xuICAgIH0pO1xuICAgIFxuICAgIC8vdGhpcy5kYXRhLmZvckVhY2goKGUpID0+IGUgPSBVdGlscy5zb2Z0TWF4KGUpKVxuICB9XG5cbiAgZG9BZGQodzogU3luYXB0aWMuSU51bWVyaWNBcnJheSwgYWRkR2F0ZTogU3luYXB0aWMuSU51bWVyaWNBcnJheSkge1xuICAgIGZvciAodmFyIG4gPSAwOyBuIDwgdGhpcy5ibG9ja3M7IG4rKykge1xuICAgICAgdmFyIE0gPSB0aGlzLmRhdGFbbl07XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuYmxvY2tXaWR0aDsgaSsrKSB7XG4gICAgICAgIE1baV0gKz0gYWRkR2F0ZVtuXSAqIHdbaV07XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZG9FcmFzZSh3OiBTeW5hcHRpYy5JTnVtZXJpY0FycmF5LCBlcmFzZUdhdGU6IFN5bmFwdGljLklOdW1lcmljQXJyYXkpIHtcbiAgICBmb3IgKHZhciBuID0gMDsgbiA8IHRoaXMuYmxvY2tzOyBuKyspIHtcbiAgICAgIHZhciBNID0gdGhpcy5kYXRhW25dO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmJsb2NrV2lkdGg7IGkrKykge1xuICAgICAgICBNW2ldICo9IDEgLSBlcmFzZUdhdGVbbl0gKiB3W2ldO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBub3JtYWxpemVTaGlmdChzaGlmdDogRmxvYXQ2NEFycmF5KSB7XG5cbiAgICAgICAgdmFyIHN1bSA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2hpZnQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHN1bSArPSBzaGlmdFtpXTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNoaWZ0Lmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBzaGlmdFtqXSAvPSBzdW07XG4gICAgICAgIH1cbiAgICB9XG5cbmV4cG9ydCBjbGFzcyBIZWFkIHtcbiAgc3RhdGljIEFERElUSU9OQUxfSU5QVVRfVkFMVUVTID0gMztcbiAgXG4gIG1lbW9yeTogTlRNO1xuXG4gIHdfd2VpZ2h0aW5nczogRmxvYXQ2NEFycmF5O1xuICBlcmFzZUdhdGU6IEZsb2F0NjRBcnJheTtcbiAgYWRkR2F0ZTogRmxvYXQ2NEFycmF5O1xuICBrX2tleXM6IEZsb2F0NjRBcnJheTtcbiAgZ19pbnRlcnBvbGF0aW9uOiBudW1iZXI7XG4gIFlfZm9jdXM6IG51bWJlcjtcbiAgc19zaGlmdGluZ1ZhbHVlOiBudW1iZXIgPSBudWxsO1xuICBzX3NoaWZ0aW5nVmVjdG9yOiBGbG9hdDY0QXJyYXk7XG4gIHdjX2ZvY3VzZWRXZWlnaHRzOiBGbG9hdDY0QXJyYXk7XG4gIHJlYWRWZWN0b3I6IEZsb2F0NjRBcnJheTtcbiAgw59fa2V5U3RyZW5ndGg6IG51bWJlcjtcbiAgcHJldkZvY3VzOiBudW1iZXIgPSAxO1xuICBcbiAgbGF5ZXI6IExheWVyLkxheWVyO1xuXG4gIGNvbnN0cnVjdG9yKG1lbW9yeTogTlRNLCBkZXN0aW5hdGlvbkFycmF5PzogRmxvYXQ2NEFycmF5KSB7XG4gICAgdGhpcy5tZW1vcnkgPSBtZW1vcnk7XG4gICAgdGhpcy53Y19mb2N1c2VkV2VpZ2h0cyA9IG5ldyBGbG9hdDY0QXJyYXkodGhpcy5tZW1vcnkuYmxvY2tzKTtcbiAgICB0aGlzLndfd2VpZ2h0aW5ncyA9IG5ldyBGbG9hdDY0QXJyYXkodGhpcy5tZW1vcnkuYmxvY2tzKTtcbiAgICB0aGlzLnNfc2hpZnRpbmdWZWN0b3IgPSBuZXcgRmxvYXQ2NEFycmF5KHRoaXMubWVtb3J5LmJsb2Nrcyk7XG4gICAgdGhpcy5rX2tleXMgPSBuZXcgRmxvYXQ2NEFycmF5KHRoaXMubWVtb3J5LmJsb2NrV2lkdGgpO1xuICAgIHRoaXMuw59fa2V5U3RyZW5ndGggPSAwO1xuICAgIHRoaXMuZXJhc2VHYXRlID0gbmV3IEZsb2F0NjRBcnJheSh0aGlzLm1lbW9yeS5ibG9ja3MpO1xuICAgIHRoaXMuYWRkR2F0ZSA9IG5ldyBGbG9hdDY0QXJyYXkodGhpcy5tZW1vcnkuYmxvY2tzKTtcbiAgICB0aGlzLnJlYWRWZWN0b3IgPSBkZXN0aW5hdGlvbkFycmF5IHx8IG5ldyBGbG9hdDY0QXJyYXkodGhpcy5tZW1vcnkuYmxvY2tzKTtcbiAgICBcbiAgICB0aGlzLmxheWVyID0gbmV3IExheWVyLkxheWVyKHRoaXMubWVtb3J5LmJsb2NrV2lkdGggKiA0ICsgSGVhZC5BRERJVElPTkFMX0lOUFVUX1ZBTFVFUyk7XG4gICAgXG4gICAgdGhpcy5tZW1vcnkuaGlkZGVuTGF5ZXIucHJvamVjdCh0aGlzLmxheWVyLCBMYXllci5MYXllci5jb25uZWN0aW9uVHlwZS5BTExfVE9fQUxMKTtcbiAgICB0aGlzLmxheWVyLnByb2plY3QodGhpcy5tZW1vcnkub3V0cHV0TGF5ZXIsIExheWVyLkxheWVyLmNvbm5lY3Rpb25UeXBlLkFMTF9UT19BTEwpO1xuICB9XG4gIFxuICBcblxuICBkb1RpbWVTdGVwKCkge1xuICAgIHZhciBhY3RpdmF0aW9uID0gdGhpcy5sYXllci5hY3RpdmF0ZSgpO1xuICAgIFxuICAgIHRoaXMuw59fa2V5U3RyZW5ndGggPSBTcXVhc2guU09GVFBMVVMoYWN0aXZhdGlvblswXSk7XG4gICAgdGhpcy5nX2ludGVycG9sYXRpb24gPSBTcXVhc2guTE9HSVNUSUMoYWN0aXZhdGlvblsxXSwgdHJ1ZSk7XG4gICAgdGhpcy5ZX2ZvY3VzID0gTWF0aC5leHAoYWN0aXZhdGlvblsyXSkgKyAxMDtcbiAgICBcbiAgICB2YXIgc3RhcnRBdCA9IDM7XG4gICAgZm9yICh2YXIgayA9IDA7IGsgPCB0aGlzLmtfa2V5cy5sZW5ndGg7IGsrKykge1xuICAgICAgdGhpcy5rX2tleXNba10gPSB0aGlzLmxheWVyLmxpc3RbayArIHN0YXJ0QXRdLmFjdGl2YXRpb247XG4gICAgfVxuICAgIFxuICAgIHN0YXJ0QXQgKz0gdGhpcy5rX2tleXMubGVuZ3RoO1xuICAgIGZvciAodmFyIGsgPSAwOyBrIDwgdGhpcy5rX2tleXMubGVuZ3RoOyBrKyspIHtcbiAgICAgIHRoaXMuYWRkR2F0ZVtrXSA9IHRoaXMubGF5ZXIubGlzdFtrICsgc3RhcnRBdF0uZGVyaXZhdGl2ZTtcbiAgICB9XG4gICBcbiAgICBzdGFydEF0ICs9IHRoaXMua19rZXlzLmxlbmd0aDsgXG4gICAgZm9yICh2YXIgayA9IDA7IGsgPCB0aGlzLmtfa2V5cy5sZW5ndGg7IGsrKykge1xuICAgICAgdGhpcy5lcmFzZUdhdGVba10gPSB0aGlzLmxheWVyLmxpc3RbayArIHN0YXJ0QXRdLmFjdGl2YXRpb247XG4gICAgfVxuICAgIFxuXG4gICAgc3RhcnRBdCArPSB0aGlzLmtfa2V5cy5sZW5ndGg7XG4gICAgXG4gICAgXG4gICAgLy9pZih0aGlzLm1lbW9yeS5kaXJ0eSl7XG4gICAgICBmb3IgKHZhciBrID0gMDsgayA8IHRoaXMua19rZXlzLmxlbmd0aDsgaysrKSB7XG4gICAgICAgIHRoaXMuc19zaGlmdGluZ1ZlY3RvcltrXSA9IHRoaXMubGF5ZXIubGlzdFtrICsgc3RhcnRBdF0uYWN0aXZhdGlvbjsgXG4gICAgICB9XG4gICAgLyp9IGVsc2Uge1xuICAgICAgdGhpcy5wcmV2Rm9jdXMrKztcbiAgICAgIHRoaXMucHJldkZvY3VzID0gdGhpcy5wcmV2Rm9jdXMgJSB0aGlzLmtfa2V5cy5sZW5ndGg7XG4gICAgICBcbiAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgdGhpcy5rX2tleXMubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgdGhpcy5zX3NoaWZ0aW5nVmVjdG9yW2tdID0gMDsgXG4gICAgICB9XG4gICAgICBcbiAgICAgIHRoaXMuc19zaGlmdGluZ1ZlY3Rvclt0aGlzLnByZXZGb2N1c10gPSAxOyBcbiAgICB9Ki9cbiAgICBcbiAgICBcbiAgICBcbiAgICB2YXIgTSA9IHRoaXMubWVtb3J5LmRhdGE7XG4gICAgXG4gICAgLy8gZm9jdXMgYnkgY29udGVudCwgb2J0YWlucyBhbiBhcnJheSBvZiBzaW1pbGFyaXR5IGluZGV4ZXMgZm9yIGVhY2ggbWVtb3J5QmxvY2tcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IE0ubGVuZ3RoOyBpKyspXG4gICAgICB0aGlzLndjX2ZvY3VzZWRXZWlnaHRzW2ldID0gVXRpbHMuZ2V0Q29zaW5lU2ltaWxhcml0eShNW2ldLCB0aGlzLmtfa2V5cyk7XG4gICAgXG4gICAgLy8gZm9jdXMgYnkgbG9jYXRpb24gKGludGVycG9sYXRpb24pXG4gICAgVXRpbHMuaW50ZXJwb2xhdGVBcnJheSh0aGlzLndjX2ZvY3VzZWRXZWlnaHRzLCB0aGlzLndfd2VpZ2h0aW5ncywgdGhpcy5nX2ludGVycG9sYXRpb24pO1xuICAgIFxuICAgIC8vIGNvbnZvbHV0aW9uYWwgc2hpZnRcbiAgICBVdGlscy5zb2Z0TWF4KHRoaXMuc19zaGlmdGluZ1ZlY3RvciwgMTApO1xuICAgIFV0aWxzLnZlY3RvclNoaWZ0aW5nKHRoaXMud2NfZm9jdXNlZFdlaWdodHMsIHRoaXMuc19zaGlmdGluZ1ZlY3Rvcik7XG4gICAgXG4gICAgIFxuICAgIC8vIHNoYXJwZW5pbmdcbiAgICBVdGlscy5zaGFycEFycmF5KHRoaXMud193ZWlnaHRpbmdzLCB0aGlzLndjX2ZvY3VzZWRXZWlnaHRzLCB0aGlzLllfZm9jdXMpO1xuICAgIFxuICAgIC8vLyB3ZSBnb3Qgd3QhXG4gICAgXG4gICAgLy8gc2luY2Ug4oiRIHcgPSAxLCB3ZSBoYXZlIHRvIHNvZnRtYXggdGhlIGFycmF5XG4gICAgVXRpbHMuc29mdE1heCh0aGlzLndfd2VpZ2h0aW5ncyk7XG4gICAgXG4gICAgLy8gcmVhZGluZ1xuICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLm1lbW9yeS5ibG9ja3M7IGluZGV4KyspIHtcbiAgICAgIHRoaXMucmVhZFZlY3RvcltpbmRleF0gPSAwO1xuICAgICAgZm9yICh2YXIgY2VsbCA9IDA7IGNlbGwgPCB0aGlzLm1lbW9yeS5ibG9ja1dpZHRoOyBjZWxsKyspIHtcbiAgICAgICAgdGhpcy5yZWFkVmVjdG9yW2luZGV4XSArPSB0aGlzLm1lbW9yeS5kYXRhW2luZGV4XVtjZWxsXSAqIHRoaXMud193ZWlnaHRpbmdzW2luZGV4XTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn0iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=