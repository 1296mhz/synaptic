var neuron = require('./neuron');
var network = require('./network');
/*******************************************************************************************
                                            LAYER
*******************************************************************************************/
var Layer = (function () {
    function Layer(size, label) {
        this.list = [];
        this.label = null;
        this.connectedto = [];
        this.size = 0;
        this.size = size | 0;
        this.list = [];
        this.label = label || null;
        this.connectedto = [];
        while (size--) {
            var theNeuron = new neuron.Neuron();
            this.list.push(theNeuron);
        }
    }
    // activates all the neurons in the layer
    Layer.prototype.activate = function (input) {
        var activations = [];
        if (typeof input != 'undefined') {
            if (input.length != this.size)
                throw "INPUT size and LAYER size must be the same to activate!";
            for (var id in this.list) {
                var neuron = this.list[id];
                var activation = neuron.activate(input[id]);
                activations.push(activation);
            }
        }
        else {
            for (var id in this.list) {
                var neuron = this.list[id];
                var activation = neuron.activate();
                activations.push(activation);
            }
        }
        return activations;
    };
    // propagates the error on all the neurons of the layer
    Layer.prototype.propagate = function (rate, target) {
        if (typeof target != 'undefined') {
            if (target.length != this.size)
                throw "TARGET size and LAYER size must be the same to propagate!";
            for (var id = this.list.length - 1; id >= 0; id--) {
                var neuron = this.list[id];
                neuron.propagate(rate, target[id]);
            }
        }
        else {
            for (var id = this.list.length - 1; id >= 0; id--) {
                var neuron = this.list[id];
                neuron.propagate(rate);
            }
        }
    };
    // projects a connection from this layer to another one
    Layer.prototype.project = function (layer, type, weights) {
        if (layer instanceof network.Network)
            layer = layer.layers.input;
        if (layer instanceof Layer) {
            if (!this.connected(layer))
                return new Layer.LayerConnection(this, layer, type, weights);
        }
        else
            throw "Invalid argument, you can only project connections to LAYERS and NETWORKS!";
    };
    // gates a connection betwenn two layers
    Layer.prototype.gate = function (connection, type) {
        if (type == Layer.gateType.INPUT) {
            if (connection.to.size != this.size)
                throw "GATER layer and CONNECTION.TO layer must be the same size in order to gate!";
            for (var id in connection.to.list) {
                var neuron = connection.to.list[id];
                var gater = this.list[id];
                for (var input in neuron.connections.inputs) {
                    var gated = neuron.connections.inputs[input];
                    if (gated.ID in connection.connections)
                        gater.gate(gated);
                }
            }
        }
        else if (type == Layer.gateType.OUTPUT) {
            if (connection.from.size != this.size)
                throw "GATER layer and CONNECTION.FROM layer must be the same size in order to gate!";
            for (var id in connection.from.list) {
                var neuron = connection.from.list[id];
                var gater = this.list[id];
                for (var projected in neuron.connections.projected) {
                    var gated = neuron.connections.projected[projected];
                    if (gated.ID in connection.connections)
                        gater.gate(gated);
                }
            }
        }
        else if (type == Layer.gateType.ONE_TO_ONE) {
            if (connection.size != this.size)
                throw "The number of GATER UNITS must be the same as the number of CONNECTIONS to gate!";
            for (var id in connection.list) {
                var gater = this.list[id];
                var gated = connection.list[id];
                gater.gate(gated);
            }
        }
        connection.gatedfrom.push({ layer: this, type: type });
    };
    // true or false whether the whole layer is self-connected or not
    Layer.prototype.selfconnected = function () {
        for (var id in this.list) {
            var neuron = this.list[id];
            if (!neuron.selfconnected())
                return false;
        }
        return true;
    };
    // true of false whether the layer is connected to another layer (parameter) or not
    Layer.prototype.connected = function (layer) {
        // Check if ALL to ALL connection
        var connections = 0;
        for (var here in this.list) {
            for (var there in layer.list) {
                var from = this.list[here];
                var to = layer.list[there];
                var connected = from.connected(to);
                if (connected && connected.type == 'projected')
                    connections++;
            }
        }
        if (connections == this.size * layer.size)
            return Layer.connectionType.ALL_TO_ALL;
        // Check if ONE to ONE connection
        connections = 0;
        for (var neuron in this.list) {
            var from = this.list[neuron];
            var to = layer.list[neuron];
            var connected = from.connected(to);
            if (connected && connected.type == 'projected')
                connections++;
        }
        if (connections == this.size)
            return Layer.connectionType.ONE_TO_ONE;
    };
    // clears all the neuorns in the layer
    Layer.prototype.clear = function () {
        for (var id in this.list) {
            var neuron = this.list[id];
            neuron.clear();
        }
    };
    // resets all the neurons in the layer
    Layer.prototype.reset = function () {
        for (var id in this.list) {
            var neuron = this.list[id];
            neuron.reset();
        }
    };
    // returns all the neurons in the layer (array)
    Layer.prototype.neurons = function () {
        return this.list;
    };
    // adds a neuron to the layer
    Layer.prototype.add = function (neuron) {
        neuron = neuron || new neuron.Neuron();
        this.neurons[neuron.ID] = neuron;
        this.list.push(neuron);
        this.size++;
    };
    Layer.prototype.set = function (options) {
        options = options || {};
        for (var i in this.list) {
            var neuron = this.list[i];
            if (options.label)
                neuron.label = options.label + '_' + neuron.ID;
            if (options.squash)
                neuron.squash = options.squash;
            if (options.bias)
                neuron.bias = options.bias;
        }
        return this;
    };
    return Layer;
})();
exports.Layer = Layer;
var Layer;
(function (Layer) {
    Layer.layerQty = 0;
    function uid() {
        return Layer.layerQty++;
    }
    Layer.uid = uid;
    // types of connections
    Layer.connectionType = {
        ALL_TO_ALL: "ALL TO ALL",
        ONE_TO_ONE: "ONE TO ONE",
        ALL_TO_ELSE: "ALL TO ELSE"
    };
    // types of gates
    Layer.gateType = {
        INPUT: "INPUT",
        OUTPUT: "OUTPUT",
        ONE_TO_ONE: "ONE TO ONE"
    };
    // represents a connection from one layer to another, and keeps track of its weight and gain
    var LayerConnection = (function () {
        function LayerConnection(fromLayer, toLayer, type, weights) {
            this.ID = uid();
            this.selfconnection = false;
            this.size = 0;
            this.gatedfrom = [];
            this.from = fromLayer;
            this.to = toLayer;
            this.selfconnection = toLayer == fromLayer;
            this.type = type;
            this.connections = {};
            this.list = [];
            this.size = 0;
            this.gatedfrom = [];
            if (typeof this.type == 'undefined') {
                if (fromLayer == toLayer)
                    this.type = Layer.connectionType.ONE_TO_ONE;
                else
                    this.type = Layer.connectionType.ALL_TO_ALL;
            }
            if (this.type == Layer.connectionType.ALL_TO_ALL || this.type == Layer.connectionType.ALL_TO_ELSE) {
                for (var here in this.from.list) {
                    for (var there in this.to.list) {
                        var from = this.from.list[here];
                        var to = this.to.list[there];
                        if (this.type == Layer.connectionType.ALL_TO_ELSE && from == to)
                            continue;
                        var connection = from.project(to, weights);
                        this.connections[connection.ID] = connection;
                        this.size = this.list.push(connection);
                    }
                }
            }
            else if (this.type == Layer.connectionType.ONE_TO_ONE) {
                for (var neuron in this.from.list) {
                    var from = this.from.list[neuron];
                    var to = this.to.list[neuron];
                    var connection = from.project(to, weights);
                    this.connections[connection.ID] = connection;
                    this.size = this.list.push(connection);
                }
            }
            fromLayer.connectedto.push(this);
        }
        return LayerConnection;
    })();
    Layer.LayerConnection = LayerConnection;
})(Layer = exports.Layer || (exports.Layer = {}));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9sYXllci50cyJdLCJuYW1lcyI6WyJMYXllciIsIkxheWVyLmNvbnN0cnVjdG9yIiwiTGF5ZXIuYWN0aXZhdGUiLCJMYXllci5wcm9wYWdhdGUiLCJMYXllci5wcm9qZWN0IiwiTGF5ZXIuZ2F0ZSIsIkxheWVyLnNlbGZjb25uZWN0ZWQiLCJMYXllci5jb25uZWN0ZWQiLCJMYXllci5jbGVhciIsIkxheWVyLnJlc2V0IiwiTGF5ZXIubmV1cm9ucyIsIkxheWVyLmFkZCIsIkxheWVyLnNldCIsIkxheWVyLnVpZCIsIkxheWVyLkxheWVyQ29ubmVjdGlvbiIsIkxheWVyLkxheWVyQ29ubmVjdGlvbi5jb25zdHJ1Y3RvciJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBTyxNQUFNLFdBQVcsVUFBVSxDQUFDLENBQUM7QUFDcEMsSUFBTyxPQUFPLFdBQVcsV0FBVyxDQUFDLENBQUM7QUFHdEMsQUFHQTs7NEZBRDRGO0lBQy9FLEtBQUs7SUFNaEJBLFNBTldBLEtBQUtBLENBTUpBLElBQVlBLEVBQUVBLEtBQWNBO1FBTHhDQyxTQUFJQSxHQUFvQkEsRUFBRUEsQ0FBQ0E7UUFDM0JBLFVBQUtBLEdBQVdBLElBQUlBLENBQUNBO1FBQ3JCQSxnQkFBV0EsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFDakJBLFNBQUlBLEdBQUdBLENBQUNBLENBQUNBO1FBR1JBLElBQUlBLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLEdBQUdBLENBQUNBLENBQUNBO1FBQ3JCQSxJQUFJQSxDQUFDQSxJQUFJQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUNmQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxLQUFLQSxJQUFJQSxJQUFJQSxDQUFDQTtRQUMzQkEsSUFBSUEsQ0FBQ0EsV0FBV0EsR0FBR0EsRUFBRUEsQ0FBQ0E7UUFFdEJBLE9BQU9BLElBQUlBLEVBQUVBLEVBQUVBLENBQUNBO1lBQ2ZBLElBQUlBLFNBQVNBLEdBQUdBLElBQUlBLE1BQU1BLENBQUNBLE1BQU1BLEVBQUVBLENBQUNBO1lBQ3BDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQTtRQUMzQkEsQ0FBQ0E7SUFDRkEsQ0FBQ0E7SUFHREQseUNBQXlDQTtJQUN6Q0Esd0JBQVFBLEdBQVJBLFVBQVNBLEtBQUtBO1FBRWJFLElBQUlBLFdBQVdBLEdBQUdBLEVBQUVBLENBQUNBO1FBRXJCQSxFQUFFQSxDQUFDQSxDQUFDQSxPQUFPQSxLQUFLQSxJQUFJQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNqQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsSUFBSUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0E7Z0JBQzdCQSxNQUFNQSx5REFBeURBLENBQUNBO1lBRWpFQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxJQUFJQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDMUJBLElBQUlBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBO2dCQUMzQkEsSUFBSUEsVUFBVUEsR0FBR0EsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQzVDQSxXQUFXQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQTtZQUM5QkEsQ0FBQ0E7UUFDRkEsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDUEEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsSUFBSUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQzFCQSxJQUFJQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQTtnQkFDM0JBLElBQUlBLFVBQVVBLEdBQUdBLE1BQU1BLENBQUNBLFFBQVFBLEVBQUVBLENBQUNBO2dCQUNuQ0EsV0FBV0EsQ0FBQ0EsSUFB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QWZBLGVBeURaQSxDQUFBQTtBQUNGQSxDQUFDQSxFQS9FYSxLQUFLLEdBQUwsYUFBSyxLQUFMLGFBQUssUUErRWxCIiwiZmlsZSI6InNyYy9sYXllci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBuZXVyb24gPSByZXF1aXJlKCcuL25ldXJvbicpO1xuaW1wb3J0IG5ldHdvcmsgPSByZXF1aXJlKCcuL25ldHdvcmsnKTtcbmltcG9ydCBTeW5hcHRpYyA9IHJlcXVpcmUoJy4vc3luYXB0aWMnKTtcblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTEFZRVJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5leHBvcnQgY2xhc3MgTGF5ZXIge1xuXHRcdGxpc3Q6IG5ldXJvbi5OZXVyb25bXSA9IFtdO1xuXHRcdGxhYmVsOiBzdHJpbmcgPSBudWxsO1xuXHRcdGNvbm5lY3RlZHRvID0gW107XG5cdFx0c2l6ZSA9IDA7XG5cblx0XHRjb25zdHJ1Y3RvcihzaXplOiBudW1iZXIsIGxhYmVsPzogc3RyaW5nKSB7XG5cdFx0XHR0aGlzLnNpemUgPSBzaXplIHwgMDtcblx0XHRcdHRoaXMubGlzdCA9IFtdO1xuXHRcdFx0dGhpcy5sYWJlbCA9IGxhYmVsIHx8IG51bGw7XG5cdFx0XHR0aGlzLmNvbm5lY3RlZHRvID0gW107XG5cblx0XHRcdHdoaWxlIChzaXplLS0pIHtcblx0XHRcdFx0dmFyIHRoZU5ldXJvbiA9IG5ldyBuZXVyb24uTmV1cm9uKCk7XG5cdFx0XHRcdHRoaXMubGlzdC5wdXNoKHRoZU5ldXJvbik7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFxuXHRcdC8vIGFjdGl2YXRlcyBhbGwgdGhlIG5ldXJvbnMgaW4gdGhlIGxheWVyXG5cdFx0YWN0aXZhdGUoaW5wdXQpIHtcblxuXHRcdFx0dmFyIGFjdGl2YXRpb25zID0gW107XG5cblx0XHRcdGlmICh0eXBlb2YgaW5wdXQgIT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0aWYgKGlucHV0Lmxlbmd0aCAhPSB0aGlzLnNpemUpXG5cdFx0XHRcdFx0dGhyb3cgXCJJTlBVVCBzaXplIGFuZCBMQVlFUiBzaXplIG11c3QgYmUgdGhlIHNhbWUgdG8gYWN0aXZhdGUhXCI7XG5cblx0XHRcdFx0Zm9yICh2YXIgaWQgaW4gdGhpcy5saXN0KSB7XG5cdFx0XHRcdFx0dmFyIG5ldXJvbiA9IHRoaXMubGlzdFtpZF07XG5cdFx0XHRcdFx0dmFyIGFjdGl2YXRpb24gPSBuZXVyb24uYWN0aXZhdGUoaW5wdXRbaWRdKTtcblx0XHRcdFx0XHRhY3RpdmF0aW9ucy5wdXNoKGFjdGl2YXRpb24pO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRmb3IgKHZhciBpZCBpbiB0aGlzLmxpc3QpIHtcblx0XHRcdFx0XHR2YXIgbmV1cm9uID0gdGhpcy5saXN0W2lkXTtcblx0XHRcdFx0XHR2YXIgYWN0aXZhdGlvbiA9IG5ldXJvbi5hY3RpdmF0ZSgpO1xuXHRcdFx0XHRcdGFjdGl2YXRpb25zLnB1c2goYWN0aXZhdGlvbik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHJldHVybiBhY3RpdmF0aW9ucztcblx0XHR9XG5cblx0XHQvLyBwcm9wYWdhdGVzIHRoZSBlcnJvciBvbiBhbGwgdGhlIG5ldXJvbnMgb2YgdGhlIGxheWVyXG5cdFx0cHJvcGFnYXRlKHJhdGUsIHRhcmdldCkge1xuXG5cdFx0XHRpZiAodHlwZW9mIHRhcmdldCAhPSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRpZiAodGFyZ2V0Lmxlbmd0aCAhPSB0aGlzLnNpemUpXG5cdFx0XHRcdFx0dGhyb3cgXCJUQVJHRVQgc2l6ZSBhbmQgTEFZRVIgc2l6ZSBtdXN0IGJlIHRoZSBzYW1lIHRvIHByb3BhZ2F0ZSFcIjtcblxuXHRcdFx0XHRmb3IgKHZhciBpZCA9IHRoaXMubGlzdC5sZW5ndGggLSAxOyBpZCA+PSAwOyBpZC0tKSB7XG5cdFx0XHRcdFx0dmFyIG5ldXJvbiA9IHRoaXMubGlzdFtpZF07XG5cdFx0XHRcdFx0bmV1cm9uLnByb3BhZ2F0ZShyYXRlLCB0YXJnZXRbaWRdKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Zm9yICh2YXIgaWQgPSB0aGlzLmxpc3QubGVuZ3RoIC0gMTsgaWQgPj0gMDsgaWQtLSkge1xuXHRcdFx0XHRcdHZhciBuZXVyb24gPSB0aGlzLmxpc3RbaWRdO1xuXHRcdFx0XHRcdG5ldXJvbi5wcm9wYWdhdGUocmF0ZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHQvLyBwcm9qZWN0cyBhIGNvbm5lY3Rpb24gZnJvbSB0aGlzIGxheWVyIHRvIGFub3RoZXIgb25lXG5cdFx0cHJvamVjdChsYXllciwgdHlwZT8sIHdlaWdodHM/KSB7XG5cblx0XHRcdGlmIChsYXllciBpbnN0YW5jZW9mIG5ldHdvcmsuTmV0d29yaylcblx0XHRcdFx0bGF5ZXIgPSBsYXllci5sYXllcnMuaW5wdXQ7XG5cblx0XHRcdGlmIChsYXllciBpbnN0YW5jZW9mIExheWVyKSB7XG5cdFx0XHRcdGlmICghdGhpcy5jb25uZWN0ZWQobGF5ZXIpKVxuXHRcdFx0XHRcdHJldHVybiBuZXcgTGF5ZXIuTGF5ZXJDb25uZWN0aW9uKHRoaXMsIGxheWVyLCB0eXBlLCB3ZWlnaHRzKTtcblx0XHRcdH0gZWxzZVxuXHRcdFx0XHR0aHJvdyBcIkludmFsaWQgYXJndW1lbnQsIHlvdSBjYW4gb25seSBwcm9qZWN0IGNvbm5lY3Rpb25zIHRvIExBWUVSUyBhbmQgTkVUV09SS1MhXCI7XG5cblxuXHRcdH1cblxuXHRcdC8vIGdhdGVzIGEgY29ubmVjdGlvbiBiZXR3ZW5uIHR3byBsYXllcnNcblx0XHRnYXRlKGNvbm5lY3Rpb24sIHR5cGUpIHtcblxuXHRcdFx0aWYgKHR5cGUgPT0gTGF5ZXIuZ2F0ZVR5cGUuSU5QVVQpIHtcblx0XHRcdFx0aWYgKGNvbm5lY3Rpb24udG8uc2l6ZSAhPSB0aGlzLnNpemUpXG5cdFx0XHRcdFx0dGhyb3cgXCJHQVRFUiBsYXllciBhbmQgQ09OTkVDVElPTi5UTyBsYXllciBtdXN0IGJlIHRoZSBzYW1lIHNpemUgaW4gb3JkZXIgdG8gZ2F0ZSFcIjtcblxuXHRcdFx0XHRmb3IgKHZhciBpZCBpbiBjb25uZWN0aW9uLnRvLmxpc3QpIHtcblx0XHRcdFx0XHR2YXIgbmV1cm9uID0gY29ubmVjdGlvbi50by5saXN0W2lkXTtcblx0XHRcdFx0XHR2YXIgZ2F0ZXIgPSB0aGlzLmxpc3RbaWRdO1xuXHRcdFx0XHRcdGZvciAodmFyIGlucHV0IGluIG5ldXJvbi5jb25uZWN0aW9ucy5pbnB1dHMpIHtcblx0XHRcdFx0XHRcdHZhciBnYXRlZCA9IG5ldXJvbi5jb25uZWN0aW9ucy5pbnB1dHNbaW5wdXRdO1xuXHRcdFx0XHRcdFx0aWYgKGdhdGVkLklEIGluIGNvbm5lY3Rpb24uY29ubmVjdGlvbnMpXG5cdFx0XHRcdFx0XHRcdGdhdGVyLmdhdGUoZ2F0ZWQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmICh0eXBlID09IExheWVyLmdhdGVUeXBlLk9VVFBVVCkge1xuXHRcdFx0XHRpZiAoY29ubmVjdGlvbi5mcm9tLnNpemUgIT0gdGhpcy5zaXplKVxuXHRcdFx0XHRcdHRocm93IFwiR0FURVIgbGF5ZXIgYW5kIENPTk5FQ1RJT04uRlJPTSBsYXllciBtdXN0IGJlIHRoZSBzYW1lIHNpemUgaW4gb3JkZXIgdG8gZ2F0ZSFcIjtcblxuXHRcdFx0XHRmb3IgKHZhciBpZCBpbiBjb25uZWN0aW9uLmZyb20ubGlzdCkge1xuXHRcdFx0XHRcdHZhciBuZXVyb24gPSBjb25uZWN0aW9uLmZyb20ubGlzdFtpZF07XG5cdFx0XHRcdFx0dmFyIGdhdGVyID0gdGhpcy5saXN0W2lkXTtcblx0XHRcdFx0XHRmb3IgKHZhciBwcm9qZWN0ZWQgaW4gbmV1cm9uLmNvbm5lY3Rpb25zLnByb2plY3RlZCkge1xuXHRcdFx0XHRcdFx0dmFyIGdhdGVkID0gbmV1cm9uLmNvbm5lY3Rpb25zLnByb2plY3RlZFtwcm9qZWN0ZWRdO1xuXHRcdFx0XHRcdFx0aWYgKGdhdGVkLklEIGluIGNvbm5lY3Rpb24uY29ubmVjdGlvbnMpXG5cdFx0XHRcdFx0XHRcdGdhdGVyLmdhdGUoZ2F0ZWQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmICh0eXBlID09IExheWVyLmdhdGVUeXBlLk9ORV9UT19PTkUpIHtcblx0XHRcdFx0aWYgKGNvbm5lY3Rpb24uc2l6ZSAhPSB0aGlzLnNpemUpXG5cdFx0XHRcdFx0dGhyb3cgXCJUaGUgbnVtYmVyIG9mIEdBVEVSIFVOSVRTIG11c3QgYmUgdGhlIHNhbWUgYXMgdGhlIG51bWJlciBvZiBDT05ORUNUSU9OUyB0byBnYXRlIVwiO1xuXG5cdFx0XHRcdGZvciAodmFyIGlkIGluIGNvbm5lY3Rpb24ubGlzdCkge1xuXHRcdFx0XHRcdHZhciBnYXRlciA9IHRoaXMubGlzdFtpZF07XG5cdFx0XHRcdFx0dmFyIGdhdGVkID0gY29ubmVjdGlvbi5saXN0W2lkXTtcblx0XHRcdFx0XHRnYXRlci5nYXRlKGdhdGVkKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0Y29ubmVjdGlvbi5nYXRlZGZyb20ucHVzaCh7IGxheWVyOiB0aGlzLCB0eXBlOiB0eXBlIH0pO1xuXHRcdH1cblxuXHRcdC8vIHRydWUgb3IgZmFsc2Ugd2hldGhlciB0aGUgd2hvbGUgbGF5ZXIgaXMgc2VsZi1jb25uZWN0ZWQgb3Igbm90XG5cdFx0c2VsZmNvbm5lY3RlZCgpOiBib29sZWFuIHtcblxuXHRcdFx0Zm9yICh2YXIgaWQgaW4gdGhpcy5saXN0KSB7XG5cdFx0XHRcdHZhciBuZXVyb24gPSB0aGlzLmxpc3RbaWRdO1xuXHRcdFx0XHRpZiAoIW5ldXJvbi5zZWxmY29ubmVjdGVkKCkpXG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXG5cdFx0Ly8gdHJ1ZSBvZiBmYWxzZSB3aGV0aGVyIHRoZSBsYXllciBpcyBjb25uZWN0ZWQgdG8gYW5vdGhlciBsYXllciAocGFyYW1ldGVyKSBvciBub3Rcblx0XHRjb25uZWN0ZWQobGF5ZXIpIHtcblx0XHRcdC8vIENoZWNrIGlmIEFMTCB0byBBTEwgY29ubmVjdGlvblxuXHRcdFx0dmFyIGNvbm5lY3Rpb25zID0gMDtcblx0XHRcdGZvciAodmFyIGhlcmUgaW4gdGhpcy5saXN0KSB7XG5cdFx0XHRcdGZvciAodmFyIHRoZXJlIGluIGxheWVyLmxpc3QpIHtcblx0XHRcdFx0XHR2YXIgZnJvbSA9IHRoaXMubGlzdFtoZXJlXTtcblx0XHRcdFx0XHR2YXIgdG8gPSBsYXllci5saXN0W3RoZXJlXTtcblx0XHRcdFx0XHR2YXIgY29ubmVjdGVkID0gZnJvbS5jb25uZWN0ZWQodG8pO1xuXHRcdFx0XHRcdGlmIChjb25uZWN0ZWQgJiYgY29ubmVjdGVkLnR5cGUgPT0gJ3Byb2plY3RlZCcpXG5cdFx0XHRcdFx0XHRjb25uZWN0aW9ucysrO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRpZiAoY29ubmVjdGlvbnMgPT0gdGhpcy5zaXplICogbGF5ZXIuc2l6ZSlcblx0XHRcdFx0cmV0dXJuIExheWVyLmNvbm5lY3Rpb25UeXBlLkFMTF9UT19BTEw7XG5cblx0XHRcdC8vIENoZWNrIGlmIE9ORSB0byBPTkUgY29ubmVjdGlvblxuXHRcdFx0Y29ubmVjdGlvbnMgPSAwO1xuXHRcdFx0Zm9yICh2YXIgbmV1cm9uIGluIHRoaXMubGlzdCkge1xuXHRcdFx0XHR2YXIgZnJvbSA9IHRoaXMubGlzdFtuZXVyb25dO1xuXHRcdFx0XHR2YXIgdG8gPSBsYXllci5saXN0W25ldXJvbl07XG5cdFx0XHRcdHZhciBjb25uZWN0ZWQgPSBmcm9tLmNvbm5lY3RlZCh0byk7XG5cdFx0XHRcdGlmIChjb25uZWN0ZWQgJiYgY29ubmVjdGVkLnR5cGUgPT0gJ3Byb2plY3RlZCcpXG5cdFx0XHRcdFx0Y29ubmVjdGlvbnMrKztcblx0XHRcdH1cblx0XHRcdGlmIChjb25uZWN0aW9ucyA9PSB0aGlzLnNpemUpXG5cdFx0XHRcdHJldHVybiBMYXllci5jb25uZWN0aW9uVHlwZS5PTkVfVE9fT05FO1xuXHRcdH1cblxuXHRcdC8vIGNsZWFycyBhbGwgdGhlIG5ldW9ybnMgaW4gdGhlIGxheWVyXG5cdFx0Y2xlYXIoKSB7XG5cdFx0XHRmb3IgKHZhciBpZCBpbiB0aGlzLmxpc3QpIHtcblx0XHRcdFx0dmFyIG5ldXJvbiA9IHRoaXMubGlzdFtpZF07XG5cdFx0XHRcdG5ldXJvbi5jbGVhcigpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIHJlc2V0cyBhbGwgdGhlIG5ldXJvbnMgaW4gdGhlIGxheWVyXG5cdFx0cmVzZXQoKSB7XG5cdFx0XHRmb3IgKHZhciBpZCBpbiB0aGlzLmxpc3QpIHtcblx0XHRcdFx0dmFyIG5ldXJvbiA9IHRoaXMubGlzdFtpZF07XG5cdFx0XHRcdG5ldXJvbi5yZXNldCgpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIHJldHVybnMgYWxsIHRoZSBuZXVyb25zIGluIHRoZSBsYXllciAoYXJyYXkpXG5cdFx0bmV1cm9ucygpIDogbmV1cm9uLk5ldXJvbltdIHtcblx0XHRcdHJldHVybiB0aGlzLmxpc3Q7XG5cdFx0fVxuXG5cdFx0Ly8gYWRkcyBhIG5ldXJvbiB0byB0aGUgbGF5ZXJcblx0XHRhZGQobmV1cm9uKSB7XG5cdFx0XHRuZXVyb24gPSBuZXVyb24gfHwgbmV3IG5ldXJvbi5OZXVyb24oKTtcblx0XHRcdHRoaXMubmV1cm9uc1tuZXVyb24uSURdID0gbmV1cm9uO1xuXHRcdFx0dGhpcy5saXN0LnB1c2gobmV1cm9uKTtcblx0XHRcdHRoaXMuc2l6ZSsrO1xuXHRcdH1cblxuXHRcdHNldChvcHRpb25zKSB7XG5cdFx0XHRvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuXHRcdFx0Zm9yICh2YXIgaSBpbiB0aGlzLmxpc3QpIHtcblx0XHRcdFx0dmFyIG5ldXJvbiA9IHRoaXMubGlzdFtpXTtcblx0XHRcdFx0aWYgKG9wdGlvbnMubGFiZWwpXG5cdFx0XHRcdFx0bmV1cm9uLmxhYmVsID0gb3B0aW9ucy5sYWJlbCArICdfJyArIG5ldXJvbi5JRDtcblx0XHRcdFx0aWYgKG9wdGlvbnMuc3F1YXNoKVxuXHRcdFx0XHRcdG5ldXJvbi5zcXVhc2ggPSBvcHRpb25zLnNxdWFzaDtcblx0XHRcdFx0aWYgKG9wdGlvbnMuYmlhcylcblx0XHRcdFx0XHRuZXVyb24uYmlhcyA9IG9wdGlvbnMuYmlhcztcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH1cblx0fVxuXG5cbmV4cG9ydCBtb2R1bGUgTGF5ZXIge1xuXHRleHBvcnQgdmFyIGxheWVyUXR5ID0gMDtcblx0ZXhwb3J0IGZ1bmN0aW9uIHVpZCgpIHtcblx0XHRyZXR1cm4gbGF5ZXJRdHkrKztcblx0fVxuXHRcblx0Ly8gdHlwZXMgb2YgY29ubmVjdGlvbnNcblx0ZXhwb3J0IHZhciBjb25uZWN0aW9uVHlwZSA9IHtcblx0XHRBTExfVE9fQUxMOiBcIkFMTCBUTyBBTExcIixcblx0XHRPTkVfVE9fT05FOiBcIk9ORSBUTyBPTkVcIixcblx0XHRBTExfVE9fRUxTRTogXCJBTEwgVE8gRUxTRVwiXG5cdH07XG5cblx0Ly8gdHlwZXMgb2YgZ2F0ZXNcblx0ZXhwb3J0IHZhciBnYXRlVHlwZSA9IHtcblx0XHRJTlBVVDogXCJJTlBVVFwiLFxuXHRcdE9VVFBVVDogXCJPVVRQVVRcIixcblx0XHRPTkVfVE9fT05FOiBcIk9ORSBUTyBPTkVcIlxuXHR9O1xuXG5cdC8vIHJlcHJlc2VudHMgYSBjb25uZWN0aW9uIGZyb20gb25lIGxheWVyIHRvIGFub3RoZXIsIGFuZCBrZWVwcyB0cmFjayBvZiBpdHMgd2VpZ2h0IGFuZCBnYWluXG5cdGV4cG9ydCBjbGFzcyBMYXllckNvbm5lY3Rpb24ge1xuXHRcdElEID0gdWlkKCk7XG5cdFx0ZnJvbTogTGF5ZXI7XG5cdFx0dG86IExheWVyO1xuXHRcdHNlbGZjb25uZWN0aW9uIDogYm9vbGVhbiA9IGZhbHNlO1xuXHRcdHR5cGU6IHN0cmluZztcblx0XHRjb25uZWN0aW9uczogU3luYXB0aWMuRGljdGlvbmFyeTxuZXVyb24uTmV1cm9uLkNvbm5lY3Rpb24+O1xuXHRcdGxpc3Q6IG5ldXJvbi5OZXVyb24uQ29ubmVjdGlvbltdO1xuXHRcdHNpemUgPSAwO1xuXHRcdGdhdGVkZnJvbSA9IFtdO1xuXG5cdFx0Y29uc3RydWN0b3IoZnJvbUxheWVyLCB0b0xheWVyLCB0eXBlLCB3ZWlnaHRzKSB7XG5cdFx0XHR0aGlzLmZyb20gPSBmcm9tTGF5ZXI7XG5cdFx0XHR0aGlzLnRvID0gdG9MYXllcjtcblx0XHRcdHRoaXMuc2VsZmNvbm5lY3Rpb24gPSB0b0xheWVyID09IGZyb21MYXllcjtcblx0XHRcdHRoaXMudHlwZSA9IHR5cGU7XG5cdFx0XHR0aGlzLmNvbm5lY3Rpb25zID0ge307XG5cdFx0XHR0aGlzLmxpc3QgPSBbXTtcblx0XHRcdHRoaXMuc2l6ZSA9IDA7XG5cdFx0XHR0aGlzLmdhdGVkZnJvbSA9IFtdO1xuXG5cblx0XHRcdGlmICh0eXBlb2YgdGhpcy50eXBlID09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdGlmIChmcm9tTGF5ZXIgPT0gdG9MYXllcilcblx0XHRcdFx0XHR0aGlzLnR5cGUgPSBMYXllci5jb25uZWN0aW9uVHlwZS5PTkVfVE9fT05FO1xuXHRcdFx0XHRlbHNlXG5cdFx0XHRcdFx0dGhpcy50eXBlID0gTGF5ZXIuY29ubmVjdGlvblR5cGUuQUxMX1RPX0FMTDtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHRoaXMudHlwZSA9PSBMYXllci5jb25uZWN0aW9uVHlwZS5BTExfVE9fQUxMIHx8XG5cdFx0XHRcdHRoaXMudHlwZSA9PSBMYXllci5jb25uZWN0aW9uVHlwZS5BTExfVE9fRUxTRSkge1xuXHRcdFx0XHRmb3IgKHZhciBoZXJlIGluIHRoaXMuZnJvbS5saXN0KSB7XG5cdFx0XHRcdFx0Zm9yICh2YXIgdGhlcmUgaW4gdGhpcy50by5saXN0KSB7XG5cdFx0XHRcdFx0XHR2YXIgZnJvbSA9IHRoaXMuZnJvbS5saXN0W2hlcmVdO1xuXHRcdFx0XHRcdFx0dmFyIHRvID0gdGhpcy50by5saXN0W3RoZXJlXTtcblx0XHRcdFx0XHRcdGlmICh0aGlzLnR5cGUgPT0gTGF5ZXIuY29ubmVjdGlvblR5cGUuQUxMX1RPX0VMU0UgJiYgZnJvbSA9PSB0bylcblx0XHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0XHR2YXIgY29ubmVjdGlvbiA9IGZyb20ucHJvamVjdCh0bywgd2VpZ2h0cyk7XG5cblx0XHRcdFx0XHRcdHRoaXMuY29ubmVjdGlvbnNbY29ubmVjdGlvbi5JRF0gPSBjb25uZWN0aW9uO1xuXHRcdFx0XHRcdFx0dGhpcy5zaXplID0gdGhpcy5saXN0LnB1c2goY29ubmVjdGlvbik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKHRoaXMudHlwZSA9PSBMYXllci5jb25uZWN0aW9uVHlwZS5PTkVfVE9fT05FKSB7XG5cblx0XHRcdFx0Zm9yICh2YXIgbmV1cm9uIGluIHRoaXMuZnJvbS5saXN0KSB7XG5cdFx0XHRcdFx0dmFyIGZyb20gPSB0aGlzLmZyb20ubGlzdFtuZXVyb25dO1xuXHRcdFx0XHRcdHZhciB0byA9IHRoaXMudG8ubGlzdFtuZXVyb25dO1xuXHRcdFx0XHRcdHZhciBjb25uZWN0aW9uID0gZnJvbS5wcm9qZWN0KHRvLCB3ZWlnaHRzKTtcblxuXHRcdFx0XHRcdHRoaXMuY29ubmVjdGlvbnNbY29ubmVjdGlvbi5JRF0gPSBjb25uZWN0aW9uO1xuXHRcdFx0XHRcdHRoaXMuc2l6ZSA9IHRoaXMubGlzdC5wdXNoKGNvbm5lY3Rpb24pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZyb21MYXllci5jb25uZWN0ZWR0by5wdXNoKHRoaXMpO1xuXHRcdH1cblx0fVxufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==