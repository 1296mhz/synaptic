var Utils = (function () {
    function Utils() {
    }
    Utils.softMax = function (outputArray) {
        // for all i ∈ array
        // sum = ∑ array[n]^e
        // i = î^e / sum
        // where the result ∑ array[0..n] = 1
        if (!outputArray.length)
            return outputArray;
        var sum = 0;
        for (var i = 0; i < outputArray.length; i++) {
            outputArray[i] = Math.exp(outputArray[i]);
            sum += outputArray[i];
        }
        for (var i = 0; i < outputArray.length; i++)
            outputArray[i] /= sum;
        return outputArray;
    };
    Utils.softMaxDerivative = function (outputArray) {
        // http://sysmagazine.com/posts/155235/
        if (!outputArray.length)
            return outputArray;
        var sum = 0;
        for (var i = 0; i < outputArray.length; i++) {
            outputArray[i] = Math.exp(outputArray[i]);
            sum += outputArray[i];
        }
        for (var i = 0; i < outputArray.length; i++) {
            var t = outputArray[i] /= sum;
            outputArray[i] = t * (1 - t);
        }
        return outputArray;
    };
    Utils.softMaxReinforcement = function (array, temperature) {
        // Reinforcement learning
        if (temperature === void 0) { temperature = 1; }
        if (!array.length)
            return array;
        temperature = temperature || 1;
        var sum = 0;
        for (var i = 0; i < array.length; i++) {
            array[i] = Math.exp(array[i] / temperature);
            sum += array[i];
        }
        if (sum != 0) {
            for (var i = 0; i < array.length; i++)
                array[i] /= sum;
        }
        else {
            var div = 1 / array.length;
            for (var i = 0; i < array.length; i++)
                array[i] = div;
        }
        return array;
    };
    Utils.getCosineSimilarity = function (arrayA, arrayB) {
        // http://en.wikipedia.org/wiki/Cosine_similarity
        // NTM: 3.3.1 (6)
        var dotPr = 0;
        var acumA = 0, acumB = 0;
        for (var i = 0; i < arrayA.length; i++) {
            dotPr += arrayA[i] * arrayB[i];
            acumA += arrayA[i] * arrayA[i];
            acumB += arrayB[i] * arrayB[i];
        }
        return dotPr / (Math.sqrt(acumA) * Math.sqrt(acumB) + .00005);
    };
    Utils.interpolateArray = function (output_inputA, inputB, g) {
        // 3.3.2 focus by location (7)
        var gInverted = 1 - g;
        for (var i = 0; i < output_inputA.length; i++)
            output_inputA[i] = output_inputA[i] * g + gInverted * inputB[i];
        return output_inputA;
    };
    // w_sharpWn
    Utils.sharpArray = function (output, wn, Y) {
        // 3.3.2 (9)
        var sum = 0;
        for (var i = 0; i < wn.length; i++) {
            wn[i] = Math.pow(wn[i], Y);
            sum += wn[i];
        }
        // ∀ a ∈ wn → a = a^Y / sum
        if (sum != 0) {
            for (var i = 0; i < wn.length; i++)
                output[i] = wn[i] / sum;
        }
        else {
            var div = 1 / wn.length;
            for (var i = 0; i < wn.length; i++)
                output[i] = div;
        }
    };
    //wn_shift
    Utils.scalarShifting = function (wg, shiftScalar) {
        // w~ 3.3.2 (8)
        var shiftings = new Float64Array(wg.length);
        var wn = new Float64Array(wg.length);
        var intPart = shiftScalar | 0;
        var decimalPart = shiftScalar - intPart;
        shiftings[intPart % shiftings.length] = 1 - decimalPart;
        shiftings[(intPart + 1) % shiftings.length] = decimalPart;
        for (var i = 0; i < wn.length; i++) {
            var acum = 0;
            for (var j = 0; j < wn.length; j++) {
                if ((i - j) < 0)
                    acum += wg[j] * shiftings[shiftings.length - Math.abs(i - j)];
                else
                    acum += wg[j] * shiftings[(i - j) % shiftings.length];
            }
            wn[i] = acum;
        }
        return wn;
    };
    Utils.normalizeShift = function (shift) {
        var sum = 0;
        for (var i = 0; i < shift.length; i++) {
            sum += shift[i];
        }
        for (var j = 0; j < shift.length; j++) {
            shift[j] /= sum;
        }
    };
    Utils.vectorInvertedShifting = function (wg, shiftings) {
        // w~ 3.3.2 (8)
        var ret = new Float64Array(wg.length);
        var corrimientoIndex = -((shiftings.length - 1) / 2) | 0;
        var circulantMatrix = Utils.transformationMatrixCache[wg.length] || (Utils.transformationMatrixCache[wg.length] = Utils.buildCirculantMatrix(wg.length));
        for (var i = 0; i < wg.length; i++) {
            for (var x = 0; x < wg.length; x++) {
                var tmp = 0;
                for (var shift = 0; shift < shiftings.length; shift++) {
                    var matRow = i - x + corrimientoIndex + shift;
                    while (matRow < 0)
                        matRow += wg.length;
                    matRow %= wg.length;
                    tmp += wg[circulantMatrix[x][matRow]] * shiftings[shift];
                }
                ret[i] = tmp;
            }
        }
        wg.set(ret);
    };
    Utils.initRandomSoftmaxArray = function (array) {
        for (var i = 0; i < array.length; i++) {
            array[i] = Math.random();
        }
        Utils.softMax(array);
    };
    Utils.buildCirculantMatrix = function (length, offset) {
        if (offset === void 0) { offset = 0; }
        var ret = [];
        for (var i = 0; i < length; i++) {
            var arr = new Float64Array(length);
            ret.push(arr);
            for (var n = 0; n < length; n++) {
                arr[n] = ((i + n) % length);
            }
        }
        return ret;
    };
    Utils.transformationMatrixCache = {};
    return Utils;
})();
exports.Utils = Utils;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy91dGlscy50cyJdLCJuYW1lcyI6WyJVdGlscyIsIlV0aWxzLmNvbnN0cnVjdG9yIiwiVXRpbHMuc29mdE1heCIsIlV0aWxzLnNvZnRNYXhEZXJpdmF0aXZlIiwiVXRpbHMuc29mdE1heFJlaW5mb3JjZW1lbnQiLCJVdGlscy5nZXRDb3NpbmVTaW1pbGFyaXR5IiwiVXRpbHMuaW50ZXJwb2xhdGVBcnJheSIsIlV0aWxzLnNoYXJwQXJyYXkiLCJVdGlscy5zY2FsYXJTaGlmdGluZyIsIlV0aWxzLm5vcm1hbGl6ZVNoaWZ0IiwiVXRpbHMudmVjdG9ySW52ZXJ0ZWRTaGlmdGluZyIsIlV0aWxzLmluaXRSYW5kb21Tb2Z0bWF4QXJyYXkiLCJVdGlscy5idWlsZENpcmN1bGFudE1hdHJpeCJdLCJtYXBwaW5ncyI6IkFBRUEsSUFBYSxLQUFLO0lBQWxCQSxTQUFhQSxLQUFLQTtJQWtObEJDLENBQUNBO0lBOU1RRCxhQUFPQSxHQUFkQSxVQUFpREEsV0FBY0E7UUFDN0RFLG9CQUFvQkE7UUFDcEJBLHFCQUFxQkE7UUFDckJBLGdCQUFnQkE7UUFDaEJBLHFDQUFxQ0E7UUFFckNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLFdBQVdBLENBQUNBLE1BQU1BLENBQUNBO1lBQUNBLE1BQU1BLENBQUNBLFdBQVdBLENBQUNBO1FBRTVDQSxJQUFJQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUdaQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxXQUFXQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUM1Q0EsV0FBV0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDMUNBLEdBQUdBLElBQUlBLFdBQVdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FB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O0FBbE5ZLGFBQUssR0FBTCxLQWtOWixDQUFBIiwiZmlsZSI6InNyYy91dGlscy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBTeW5hcHRpYyA9IHJlcXVpcmUoJy4vc3luYXB0aWMnKTtcblxuZXhwb3J0IGNsYXNzIFV0aWxzIHtcbiAgXG4gIHN0YXRpYyB0cmFuc2Zvcm1hdGlvbk1hdHJpeENhY2hlOiB7IFtpbmRleDogbnVtYmVyXSA6IEZsb2F0NjRBcnJheVtdIH0gPSB7fTtcbiAgXG4gIHN0YXRpYyBzb2Z0TWF4PFQgZXh0ZW5kcyBTeW5hcHRpYy5JTnVtZXJpY0FycmF5PihvdXRwdXRBcnJheTogVCk6IFQge1xuICAgIC8vIGZvciBhbGwgaSDiiIggYXJyYXlcbiAgICAvLyBzdW0gPSDiiJEgYXJyYXlbbl1eZVxuICAgIC8vIGkgPSDDrl5lIC8gc3VtXG4gICAgLy8gd2hlcmUgdGhlIHJlc3VsdCDiiJEgYXJyYXlbMC4ubl0gPSAxXG5cbiAgICBpZiAoIW91dHB1dEFycmF5Lmxlbmd0aCkgcmV0dXJuIG91dHB1dEFycmF5O1xuXG4gICAgdmFyIHN1bSA9IDA7XG5cbiAgICAvLyBzdW0gPSDiiJEgYXJyYXlbbl1eZVxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3V0cHV0QXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgIG91dHB1dEFycmF5W2ldID0gTWF0aC5leHAob3V0cHV0QXJyYXlbaV0pO1xuICAgICAgc3VtICs9IG91dHB1dEFycmF5W2ldO1xuICAgIH1cblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3V0cHV0QXJyYXkubGVuZ3RoOyBpKyspIG91dHB1dEFycmF5W2ldIC89IHN1bTtcblxuICAgIHJldHVybiBvdXRwdXRBcnJheTtcbiAgfVxuXG4gIHN0YXRpYyBzb2Z0TWF4RGVyaXZhdGl2ZTxUIGV4dGVuZHMgU3luYXB0aWMuSU51bWVyaWNBcnJheT4ob3V0cHV0QXJyYXk6IFQpOiBUIHtcbiAgICAvLyBodHRwOi8vc3lzbWFnYXppbmUuY29tL3Bvc3RzLzE1NTIzNS9cbiAgICBpZiAoIW91dHB1dEFycmF5Lmxlbmd0aCkgcmV0dXJuIG91dHB1dEFycmF5O1xuXG4gICAgdmFyIHN1bSA9IDA7XG5cbiAgICAvLyBzdW0gPSDiiJEgYXJyYXlbbl1eZVxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3V0cHV0QXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgIG91dHB1dEFycmF5W2ldID0gTWF0aC5leHAob3V0cHV0QXJyYXlbaV0pO1xuICAgICAgc3VtICs9IG91dHB1dEFycmF5W2ldO1xuICAgIH1cblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3V0cHV0QXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciB0ID0gb3V0cHV0QXJyYXlbaV0gLz0gc3VtO1xuICAgICAgXG4gICAgICBvdXRwdXRBcnJheVtpXSA9IHQgKiAoMSAtIHQpO1xuICAgIH1cblxuICAgIHJldHVybiBvdXRwdXRBcnJheTtcbiAgfVxuXG4gIHN0YXRpYyBzb2Z0TWF4UmVpbmZvcmNlbWVudDxUIGV4dGVuZHMgU3luYXB0aWMuSU51bWVyaWNBcnJheT4oYXJyYXk6IFQsIHRlbXBlcmF0dXJlID0gMSk6IFQge1xuICAgIC8vIFJlaW5mb3JjZW1lbnQgbGVhcm5pbmdcblxuICAgIGlmICghYXJyYXkubGVuZ3RoKSByZXR1cm4gYXJyYXk7XG5cbiAgICB0ZW1wZXJhdHVyZSA9IHRlbXBlcmF0dXJlIHx8IDE7XG5cbiAgICB2YXIgc3VtID0gMDtcblxuICAgIC8vIHN1bSA9IOKIkSBhcnJheVtuXV5lXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgYXJyYXlbaV0gPSBNYXRoLmV4cChhcnJheVtpXSAvIHRlbXBlcmF0dXJlKTtcbiAgICAgIHN1bSArPSBhcnJheVtpXTtcbiAgICB9XG5cbiAgICBpZiAoc3VtICE9IDApIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIGFycmF5W2ldIC89IHN1bTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGRpdiA9IDEgLyBhcnJheS5sZW5ndGg7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSBhcnJheVtpXSA9IGRpdjtcbiAgICB9XG5cbiAgICByZXR1cm4gYXJyYXk7XG4gIH1cblxuXG4gIHN0YXRpYyBnZXRDb3NpbmVTaW1pbGFyaXR5KGFycmF5QTogU3luYXB0aWMuSU51bWVyaWNBcnJheSwgYXJyYXlCOiBTeW5hcHRpYy5JTnVtZXJpY0FycmF5KTogbnVtYmVyIHtcbiAgICAvLyBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0Nvc2luZV9zaW1pbGFyaXR5XG4gICAgLy8gTlRNOiAzLjMuMSAoNilcbiAgICB2YXIgZG90UHIgPSAwO1xuXG4gICAgdmFyIGFjdW1BID0gMCwgYWN1bUIgPSAwO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheUEubGVuZ3RoOyBpKyspIHtcbiAgICAgIGRvdFByICs9IGFycmF5QVtpXSAqIGFycmF5QltpXTtcbiAgICAgIGFjdW1BICs9IGFycmF5QVtpXSAqIGFycmF5QVtpXTtcbiAgICAgIGFjdW1CICs9IGFycmF5QltpXSAqIGFycmF5QltpXTtcbiAgICB9XG5cbiAgICByZXR1cm4gZG90UHIgLyAoTWF0aC5zcXJ0KGFjdW1BKSAqIE1hdGguc3FydChhY3VtQikgKyAuMDAwMDUpO1xuICB9XG5cbiAgc3RhdGljIGludGVycG9sYXRlQXJyYXkob3V0cHV0X2lucHV0QTogU3luYXB0aWMuSU51bWVyaWNBcnJheSwgaW5wdXRCOiBTeW5hcHRpYy5JTnVtZXJpY0FycmF5LCBnKSB7XG4gICAgLy8gMy4zLjIgZm9jdXMgYnkgbG9jYXRpb24gKDcpXG4gICAgdmFyIGdJbnZlcnRlZCA9IDEgLSBnO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3V0cHV0X2lucHV0QS5sZW5ndGg7IGkrKylcbiAgICAgIG91dHB1dF9pbnB1dEFbaV0gPSBvdXRwdXRfaW5wdXRBW2ldICogZyArIGdJbnZlcnRlZCAqIGlucHV0QltpXTtcbiAgICByZXR1cm4gb3V0cHV0X2lucHV0QTtcbiAgfVxuICBcbiAgLy8gd19zaGFycFduXG4gIHN0YXRpYyBzaGFycEFycmF5KG91dHB1dDogU3luYXB0aWMuSU51bWVyaWNBcnJheSwgd246IFN5bmFwdGljLklOdW1lcmljQXJyYXksIFk6IG51bWJlcikge1xuICAgIC8vIDMuMy4yICg5KVxuICAgIHZhciBzdW0gPSAwO1xuXG4gICAgLy8g4oiAIGEg4oiIIHduIOKGkiBhID0gYV5ZXG4gICAgLy8gc3VtID0g4oiRIGFeWSBcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd24ubGVuZ3RoOyBpKyspIHtcbiAgICAgIHduW2ldID0gTWF0aC5wb3cod25baV0sIFkpO1xuICAgICAgc3VtICs9IHduW2ldO1xuICAgIH1cblxuICAgIC8vIOKIgCBhIOKIiCB3biDihpIgYSA9IGFeWSAvIHN1bVxuICAgIGlmIChzdW0gIT0gMCkge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3bi5sZW5ndGg7IGkrKykgb3V0cHV0W2ldID0gd25baV0gLyBzdW07XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBkaXYgPSAxIC8gd24ubGVuZ3RoO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3bi5sZW5ndGg7IGkrKykgb3V0cHV0W2ldID0gZGl2O1xuICAgIH1cbiAgfVxuICBcbiAgLy93bl9zaGlmdFxuICBzdGF0aWMgc2NhbGFyU2hpZnRpbmcod2c6IFN5bmFwdGljLklOdW1lcmljQXJyYXksIHNoaWZ0U2NhbGFyOiBudW1iZXIpIHtcbiAgICAvLyB3fiAzLjMuMiAoOClcbiAgICB2YXIgc2hpZnRpbmdzID0gbmV3IEZsb2F0NjRBcnJheSh3Zy5sZW5ndGgpO1xuICAgIHZhciB3biA9IG5ldyBGbG9hdDY0QXJyYXkod2cubGVuZ3RoKTtcblxuICAgIHZhciBpbnRQYXJ0ID0gc2hpZnRTY2FsYXIgfCAwO1xuICAgIHZhciBkZWNpbWFsUGFydCA9IHNoaWZ0U2NhbGFyIC0gaW50UGFydDtcblxuICAgIHNoaWZ0aW5nc1tpbnRQYXJ0ICUgc2hpZnRpbmdzLmxlbmd0aF0gPSAxIC0gZGVjaW1hbFBhcnQ7XG4gICAgc2hpZnRpbmdzWyhpbnRQYXJ0ICsgMSkgJSBzaGlmdGluZ3MubGVuZ3RoXSA9IGRlY2ltYWxQYXJ0O1xuXG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHduLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgYWN1bSA9IDA7XG4gICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHduLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIGlmICgoaSAtIGopIDwgMClcbiAgICAgICAgICBhY3VtICs9IHdnW2pdICogc2hpZnRpbmdzW3NoaWZ0aW5ncy5sZW5ndGggLSBNYXRoLmFicyhpIC0gaildO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgYWN1bSArPSB3Z1tqXSAqIHNoaWZ0aW5nc1soaSAtIGopICUgc2hpZnRpbmdzLmxlbmd0aF07XG4gICAgICB9XG4gICAgICB3bltpXSA9IGFjdW07XG4gICAgfVxuXG4gICAgcmV0dXJuIHduO1xuICB9XG5cbiAgc3RhdGljIG5vcm1hbGl6ZVNoaWZ0KHNoaWZ0OiBGbG9hdDY0QXJyYXkpIHtcbiAgICB2YXIgc3VtID0gMDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNoaWZ0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBzdW0gKz0gc2hpZnRbaV07XG4gICAgfVxuICAgIGZvciAodmFyIGogPSAwOyBqIDwgc2hpZnQubGVuZ3RoOyBqKyspIHtcbiAgICAgIHNoaWZ0W2pdIC89IHN1bTtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgdmVjdG9ySW52ZXJ0ZWRTaGlmdGluZyh3ZzogRmxvYXQ2NEFycmF5LCBzaGlmdGluZ3M6IFN5bmFwdGljLklOdW1lcmljQXJyYXkpIHtcbiAgICAvLyB3fiAzLjMuMiAoOClcblxuICAgIFxuICAgIHZhciByZXQgPSBuZXcgRmxvYXQ2NEFycmF5KHdnLmxlbmd0aCk7XG5cbiAgICB2YXIgY29ycmltaWVudG9JbmRleCA9IC0oKHNoaWZ0aW5ncy5sZW5ndGggLSAxKSAvIDIpIHwgMDtcblxuICAgIHZhciBjaXJjdWxhbnRNYXRyaXggPSBVdGlscy50cmFuc2Zvcm1hdGlvbk1hdHJpeENhY2hlW3dnLmxlbmd0aF0gfHwgKFV0aWxzLnRyYW5zZm9ybWF0aW9uTWF0cml4Q2FjaGVbd2cubGVuZ3RoXSA9IFV0aWxzLmJ1aWxkQ2lyY3VsYW50TWF0cml4KHdnLmxlbmd0aCkpO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3Zy5sZW5ndGg7IGkrKykge1xuICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB3Zy5sZW5ndGg7IHgrKykge1xuICAgICAgICB2YXIgdG1wID0gMDtcblxuICAgICAgICBmb3IgKHZhciBzaGlmdCA9IDA7IHNoaWZ0IDwgc2hpZnRpbmdzLmxlbmd0aDsgc2hpZnQrKykge1xuXG4gICAgICAgICAgdmFyIG1hdFJvdyA9IGkgLSB4ICsgY29ycmltaWVudG9JbmRleCArIHNoaWZ0O1xuXG4gICAgICAgICAgd2hpbGUgKG1hdFJvdyA8IDApXG4gICAgICAgICAgICBtYXRSb3cgKz0gd2cubGVuZ3RoO1xuXG4gICAgICAgICAgbWF0Um93ICU9IHdnLmxlbmd0aDtcblxuICAgICAgICAgIHRtcCArPSB3Z1tjaXJjdWxhbnRNYXRyaXhbeF1bbWF0Um93XV0gKiBzaGlmdGluZ3Nbc2hpZnRdO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0W2ldID0gdG1wO1xuICAgICAgfVxuXG4gICAgfVxuXG4gICAgd2cuc2V0KHJldCk7XG4gIH1cblxuICBzdGF0aWMgaW5pdFJhbmRvbVNvZnRtYXhBcnJheShhcnJheTogRmxvYXQ2NEFycmF5KTogdm9pZCB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgYXJyYXlbaV0gPSBNYXRoLnJhbmRvbSgpO1xuICAgIH1cblxuICAgIFV0aWxzLnNvZnRNYXgoYXJyYXkpO1xuICB9XG5cbiAgc3RhdGljIGJ1aWxkQ2lyY3VsYW50TWF0cml4KGxlbmd0aDogbnVtYmVyLCBvZmZzZXQ6IG51bWJlciA9IDApOiBGbG9hdDY0QXJyYXlbXSB7XG4gICAgdmFyIHJldCA9IFtdO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGFyciA9IG5ldyBGbG9hdDY0QXJyYXkobGVuZ3RoKTtcbiAgICAgIHJldC5wdXNoKGFycik7XG4gICAgICBmb3IgKHZhciBuID0gMDsgbiA8IGxlbmd0aDsgbisrKSB7XG4gICAgICAgIGFycltuXSA9ICgoaSArIG4pICUgbGVuZ3RoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmV0O1xuICB9XG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=