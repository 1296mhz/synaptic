var neuron = require('./neuron');
var network = require('./network');
/*******************************************************************************************
                                            LAYER
*******************************************************************************************/
var Layer = (function () {
    function Layer(size, label) {
        this.optimizable = true;
        this.list = [];
        this.label = null;
        this.connectedto = [];
        this.size = 0;
        this.size = size | 0;
        this.list = [];
        this.label = label || null;
        this.connectedto = [];
        this.currentActivation = new Float64Array(size);
        while (size--) {
            var theNeuron = new neuron.Neuron();
            this.list.push(theNeuron);
        }
    }
    // activates all the neurons in the layer
    Layer.prototype.activate = function (input) {
        if (this.currentActivation.length != this.list.length)
            this.currentActivation = new Float64Array(this.list.length);
        var activationIndex = 0;
        if (typeof input != 'undefined') {
            if (input.length != this.size)
                throw "INPUT size and LAYER size must be the same to activate!";
            for (var id in this.list) {
                this.currentActivation[activationIndex++] = this.list[id].activate(input[id]);
            }
        }
        else {
            for (var id in this.list) {
                this.currentActivation[activationIndex++] = this.list[id].activate();
            }
        }
        return this.currentActivation;
    };
    // propagates the error on all the neurons of the layer
    Layer.prototype.propagate = function (rate, target) {
        if (typeof target != 'undefined') {
            if (target.length != this.size)
                throw "TARGET size and LAYER size must be the same to propagate!";
            for (var id = this.list.length - 1; id >= 0; id--) {
                var neuron = this.list[id];
                neuron.propagate(rate, target[id]);
            }
        }
        else {
            for (var id = this.list.length - 1; id >= 0; id--) {
                var neuron = this.list[id];
                neuron.propagate(rate);
            }
        }
    };
    // projects a connection from this layer to another one
    Layer.prototype.project = function (layer, type, weights) {
        if (layer instanceof network.Network)
            layer = layer.layers.input;
        if (layer instanceof Layer) {
            if (!this.connected(layer))
                return new Layer.LayerConnection(this, layer, type, weights);
        }
        else
            throw "Invalid argument, you can only project connections to LAYERS and NETWORKS!";
    };
    // gates a connection betwenn two layers
    Layer.prototype.gate = function (connection, type) {
        if (type == Layer.gateType.INPUT) {
            if (connection.to.size != this.size)
                throw "GATER layer and CONNECTION.TO layer must be the same size in order to gate!";
            for (var id in connection.to.list) {
                var neuron = connection.to.list[id];
                var gater = this.list[id];
                for (var input in neuron.connections.inputs) {
                    var gated = neuron.connections.inputs[input];
                    if (gated.ID in connection.connections)
                        gater.gate(gated);
                }
            }
        }
        else if (type == Layer.gateType.OUTPUT) {
            if (connection.from.size != this.size)
                throw "GATER layer and CONNECTION.FROM layer must be the same size in order to gate!";
            for (var id in connection.from.list) {
                var neuron = connection.from.list[id];
                var gater = this.list[id];
                for (var projected in neuron.connections.projected) {
                    var gated = neuron.connections.projected[projected];
                    if (gated.ID in connection.connections)
                        gater.gate(gated);
                }
            }
        }
        else if (type == Layer.gateType.ONE_TO_ONE) {
            if (connection.size != this.size)
                throw "The number of GATER UNITS must be the same as the number of CONNECTIONS to gate!";
            for (var id in connection.list) {
                var gater = this.list[id];
                var gated = connection.list[id];
                gater.gate(gated);
            }
        }
        connection.gatedfrom.push({ layer: this, type: type });
    };
    // true or false whether the whole layer is self-connected or not
    Layer.prototype.selfconnected = function () {
        for (var id in this.list) {
            var neuron = this.list[id];
            if (!neuron.selfconnected())
                return false;
        }
        return true;
    };
    // true of false whether the layer is connected to another layer (parameter) or not
    Layer.prototype.connected = function (layer) {
        // Check if ALL to ALL connection
        var connections = 0;
        for (var here in this.list) {
            for (var there in layer.list) {
                var from = this.list[here];
                var to = layer.list[there];
                var connected = from.connected(to);
                if (connected && connected.type == 'projected')
                    connections++;
            }
        }
        if (connections == this.size * layer.size)
            return Layer.connectionType.ALL_TO_ALL;
        // Check if ONE to ONE connection
        connections = 0;
        for (var neuron in this.list) {
            var from = this.list[neuron];
            var to = layer.list[neuron];
            var connected = from.connected(to);
            if (connected && connected.type == 'projected')
                connections++;
        }
        if (connections == this.size)
            return Layer.connectionType.ONE_TO_ONE;
    };
    // clears all the neuorns in the layer
    Layer.prototype.clear = function () {
        for (var id in this.list) {
            var neuron = this.list[id];
            neuron.clear();
        }
    };
    // resets all the neurons in the layer
    Layer.prototype.reset = function () {
        for (var id in this.list) {
            var neuron = this.list[id];
            neuron.reset();
        }
    };
    // returns all the neurons in the layer (array)
    Layer.prototype.neurons = function () {
        return this.list;
    };
    // adds a neuron to the layer
    Layer.prototype.add = function (neuron) {
        neuron = neuron || new neuron.Neuron();
        this.neurons[neuron.ID] = neuron;
        this.list.push(neuron);
        this.size++;
    };
    Layer.prototype.set = function (options) {
        options = options || {};
        for (var i in this.list) {
            var neuron = this.list[i];
            if (options.label)
                neuron.label = options.label + '_' + neuron.ID;
            if (options.squash)
                neuron.squash = options.squash;
            if (options.bias)
                neuron.bias = options.bias;
        }
        return this;
    };
    return Layer;
})();
exports.Layer = Layer;
var Layer;
(function (Layer) {
    Layer.layerQty = 0;
    function uid() {
        return Layer.layerQty++;
    }
    Layer.uid = uid;
    // types of connections
    Layer.connectionType = {
        ALL_TO_ALL: "ALL TO ALL",
        ONE_TO_ONE: "ONE TO ONE",
        ALL_TO_ELSE: "ALL TO ELSE"
    };
    // types of gates
    Layer.gateType = {
        INPUT: "INPUT",
        OUTPUT: "OUTPUT",
        ONE_TO_ONE: "ONE TO ONE"
    };
    // represents a connection from one layer to another, and keeps track of its weight and gain
    var LayerConnection = (function () {
        function LayerConnection(fromLayer, toLayer, type, weights) {
            this.ID = uid();
            this.selfconnection = false;
            this.size = 0;
            this.gatedfrom = [];
            this.from = fromLayer;
            this.to = toLayer;
            this.selfconnection = toLayer == fromLayer;
            this.type = type;
            this.connections = {};
            this.list = [];
            this.size = 0;
            this.gatedfrom = [];
            if (typeof this.type == 'undefined') {
                if (fromLayer == toLayer)
                    this.type = Layer.connectionType.ONE_TO_ONE;
                else
                    this.type = Layer.connectionType.ALL_TO_ALL;
            }
            if (this.type == Layer.connectionType.ALL_TO_ALL || this.type == Layer.connectionType.ALL_TO_ELSE) {
                for (var here in this.from.list) {
                    for (var there in this.to.list) {
                        var from = this.from.list[here];
                        var to = this.to.list[there];
                        if (this.type == Layer.connectionType.ALL_TO_ELSE && from == to)
                            continue;
                        var connection = from.project(to, weights);
                        this.connections[connection.ID] = connection;
                        this.size = this.list.push(connection);
                    }
                }
            }
            else if (this.type == Layer.connectionType.ONE_TO_ONE) {
                for (var neuron in this.from.list) {
                    var from = this.from.list[neuron];
                    var to = this.to.list[neuron];
                    var connection = from.project(to, weights);
                    this.connections[connection.ID] = connection;
                    this.size = this.list.push(connection);
                }
            }
            fromLayer.connectedto.push(this);
        }
        return LayerConnection;
    })();
    Layer.LayerConnection = LayerConnection;
})(Layer = exports.Layer || (exports.Layer = {}));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9sYXllci50cyJdLCJuYW1lcyI6WyJMYXllciIsIkxheWVyLmNvbnN0cnVjdG9yIiwiTGF5ZXIuYWN0aXZhdGUiLCJMYXllci5wcm9wYWdhdGUiLCJMYXllci5wcm9qZWN0IiwiTGF5ZXIuZ2F0ZSIsIkxheWVyLnNlbGZjb25uZWN0ZWQiLCJMYXllci5jb25uZWN0ZWQiLCJMYXllci5jbGVhciIsIkxheWVyLnJlc2V0IiwiTGF5ZXIubmV1cm9ucyIsIkxheWVyLmFkZCIsIkxheWVyLnNldCIsIkxheWVyLnVpZCIsIkxheWVyLkxheWVyQ29ubmVjdGlvbiIsIkxheWVyLkxheWVyQ29ubmVjdGlvbi5jb25zdHJ1Y3RvciJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBTyxNQUFNLFdBQVcsVUFBVSxDQUFDLENBQUM7QUFDcEMsSUFBTyxPQUFPLFdBQVcsV0FBVyxDQUFDLENBQUM7QUFHdEMsQUFHQTs7NEZBRDRGO0lBQy9FLEtBQUs7SUFTakJBLFNBVFlBLEtBQUtBLENBU0xBLElBQVlBLEVBQUVBLEtBQWNBO1FBUnhDQyxnQkFBV0EsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDbkJBLFNBQUlBLEdBQW9CQSxFQUFFQSxDQUFDQTtRQUMzQkEsVUFBS0EsR0FBV0EsSUFBSUEsQ0FBQ0E7UUFDckJBLGdCQUFXQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUNqQkEsU0FBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFLUkEsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDckJBLElBQUlBLENBQUNBLElBQUlBLEdBQUdBLEVBQUVBLENBQUNBO1FBQ2ZBLElBQUlBLENBQUNBLEtBQUtBLEdBQUdBLEtBQUtBLElBQUlBLElBQUlBLENBQUNBO1FBQzNCQSxJQUFJQSxDQUFDQSxXQUFXQSxHQUFHQSxFQUFFQSxDQUFDQTtRQUV0QkEsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxHQUFHQSxJQUFJQSxZQUFZQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUVoREEsT0FBT0EsSUFBSUEsRUFBRUEsRUFBRUEsQ0FBQ0E7WUFDZkEsSUFBSUEsU0FBU0EsR0FBR0EsSUFBSUEsTUFBTUEsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0E7WUFDcENBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBO1FBQzNCQSxDQUFDQTtJQUNGQSxDQUFDQTtJQUdERCx5Q0FBeUNBO0lBQ3pDQSx3QkFBUUEsR0FBUkEsVUFBU0EsS0FBOEJBO1FBRXRDRSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLE1BQU1BLElBQUlBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBO1lBQ3JEQSxJQUFJQSxDQUFDQSxpQkFBaUJBLEdBQUdBLElBQUlBLFlBQVlBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBRTdEQSxJQUFJQSxlQUFlQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUV4QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsT0FBT0EsS0FBS0EsSUFBSUEsV0FBV0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDakNBLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLElBQUlBLElBQUlBLENBQUNBLElBQUlBLENBQUNBO2dCQUM3QkEsTUFBTUEseURBQXlEQSxDQUFDQTtZQUVqRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsSUFBSUEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQzFCQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLGVBQWVBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLFFBQVFBLENBQUNBLEtBQUtBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1lBQy9FQSxDQUFDQTtRQUNGQSxDQUFDQTtRQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNQQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxJQUFJQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDMUJBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsZUFBZUEsRUFBRUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsUUFBUUEsRUFBRUEsQ0FBQ0E7WUFDdEVBLENBQUNBO1FBQ0ZBLENBQUNBO1FBRURBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0E7SUFDL0JBLENBQUNBO0lBRURGLHVEQUF1REE7SUFDdkRBLHlCQUFTQSxHQUFUQSxVQUFVQSxJQUFZQSxFQUFFQSxNQUErQkE7UUFDdERHLEVBQUVBLENBQUNBLENBQUNBLE9BQU9BLE1BQU1BLElBQUlBLFdBQVdBLENBQUNBLENBQUNBLENBQUNBO1lBQ2xDQSxFQUFFQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxNQUFNQSxJQUFJQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQTtnQkFDOUJBLE1BQU1BLDJEQUEyREEsQ0FBQ0E7WUFFbkVBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLEdBQUdBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLENBQUNBLEVBQUVBLEVBQUVBLElBQUlBLENBQUNBLEVBQUVBLEVBQUVBLEVBQUVBLEVBQUVBLENBQUNBO2dCQUNuREEsSUFBSUEsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7Z0JBQzNCQSxNQUFNQSxDQUFDQSxTQUFTQSxDQUFDQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNwQ0EsQ0FBQ0E7UUFDRkEsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDUEEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFB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LENBQUNBLFdBQVdBLElBQUlBLElBQUlBLElBQUlBLEVBQUVBLENBQUNBOzRCQUMvREEsUUFBUUEsQ0FBQ0E7d0JBQ1ZBLElBQUlBLFVBQVVBLEdBQUdBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLEVBQUVBLEVBQUVBLE9BQU9BLENBQUNBLENBQUNBO3dCQUUzQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsVUFBVUEsQ0FBQ0E7d0JBQzdDQSxJQUFJQSxDQUFDQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQTtvQkFDeENBLENBQUNBO2dCQUNGQSxDQUFDQTtZQUNGQSxDQUFDQTtZQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxJQUFJQSxLQUFLQSxDQUFDQSxjQUFjQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFFekRBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLElBQUlBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO29CQUNuQ0EsSUFBSUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7b0JBQ2xDQSxJQUFJQSxFQUFFQSxHQUFHQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtvQkFDOUJBLElBQUlBLFVBQVVBLEdBQUdBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLEVBQUVBLEVBQUVBLE9BQU9BLENBQUNBLENBQUNBO29CQUUzQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsVUFBVUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsVUFBVUEsQ0FBQ0E7b0JBQzdDQSxJQUFJQSxDQUFDQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQTtnQkFDeENBLENBQUNBO1lBQ0ZBLENBQUNBO1lBRURBLFNBQVNBLENBQUNBLFdBQVdBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQ2xDQSxDQUFDQTtRQUNGRCxzQkFBQ0E7SUFBREEsQ0F6REFkLEFBeURDYyxJQUFBZDtJQXpEWUEscUJBQWVBLEdBQWZBLGVBeURaQSxDQUFBQTtBQUNGQSxDQUFDQSxFQS9FYSxLQUFLLEdBQUwsYUFBSyxLQUFMLGFBQUssUUErRWxCIiwiZmlsZSI6InNyYy9sYXllci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBuZXVyb24gPSByZXF1aXJlKCcuL25ldXJvbicpO1xuaW1wb3J0IG5ldHdvcmsgPSByZXF1aXJlKCcuL25ldHdvcmsnKTtcbmltcG9ydCBTeW5hcHRpYyA9IHJlcXVpcmUoJy4vc3luYXB0aWMnKTtcblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTEFZRVJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5leHBvcnQgY2xhc3MgTGF5ZXIge1xuXHRvcHRpbWl6YWJsZSA9IHRydWU7XG5cdGxpc3Q6IG5ldXJvbi5OZXVyb25bXSA9IFtdO1xuXHRsYWJlbDogc3RyaW5nID0gbnVsbDtcblx0Y29ubmVjdGVkdG8gPSBbXTtcblx0c2l6ZSA9IDA7XG5cblx0Y3VycmVudEFjdGl2YXRpb246IEZsb2F0NjRBcnJheTtcblxuXHRjb25zdHJ1Y3RvcihzaXplOiBudW1iZXIsIGxhYmVsPzogc3RyaW5nKSB7XG5cdFx0dGhpcy5zaXplID0gc2l6ZSB8IDA7XG5cdFx0dGhpcy5saXN0ID0gW107XG5cdFx0dGhpcy5sYWJlbCA9IGxhYmVsIHx8IG51bGw7XG5cdFx0dGhpcy5jb25uZWN0ZWR0byA9IFtdO1xuXG5cdFx0dGhpcy5jdXJyZW50QWN0aXZhdGlvbiA9IG5ldyBGbG9hdDY0QXJyYXkoc2l6ZSk7XG5cblx0XHR3aGlsZSAoc2l6ZS0tKSB7XG5cdFx0XHR2YXIgdGhlTmV1cm9uID0gbmV3IG5ldXJvbi5OZXVyb24oKTtcblx0XHRcdHRoaXMubGlzdC5wdXNoKHRoZU5ldXJvbik7XG5cdFx0fVxuXHR9XG5cblx0XG5cdC8vIGFjdGl2YXRlcyBhbGwgdGhlIG5ldXJvbnMgaW4gdGhlIGxheWVyXG5cdGFjdGl2YXRlKGlucHV0PzogU3luYXB0aWMuSU51bWVyaWNBcnJheSk6IFN5bmFwdGljLklOdW1lcmljQXJyYXkge1xuXG5cdFx0aWYgKHRoaXMuY3VycmVudEFjdGl2YXRpb24ubGVuZ3RoICE9IHRoaXMubGlzdC5sZW5ndGgpXG5cdFx0XHR0aGlzLmN1cnJlbnRBY3RpdmF0aW9uID0gbmV3IEZsb2F0NjRBcnJheSh0aGlzLmxpc3QubGVuZ3RoKTtcblxuXHRcdHZhciBhY3RpdmF0aW9uSW5kZXggPSAwO1xuXG5cdFx0aWYgKHR5cGVvZiBpbnB1dCAhPSAndW5kZWZpbmVkJykge1xuXHRcdFx0aWYgKGlucHV0Lmxlbmd0aCAhPSB0aGlzLnNpemUpXG5cdFx0XHRcdHRocm93IFwiSU5QVVQgc2l6ZSBhbmQgTEFZRVIgc2l6ZSBtdXN0IGJlIHRoZSBzYW1lIHRvIGFjdGl2YXRlIVwiO1xuXG5cdFx0XHRmb3IgKHZhciBpZCBpbiB0aGlzLmxpc3QpIHtcblx0XHRcdFx0dGhpcy5jdXJyZW50QWN0aXZhdGlvblthY3RpdmF0aW9uSW5kZXgrK10gPSB0aGlzLmxpc3RbaWRdLmFjdGl2YXRlKGlucHV0W2lkXSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGZvciAodmFyIGlkIGluIHRoaXMubGlzdCkge1xuXHRcdFx0XHR0aGlzLmN1cnJlbnRBY3RpdmF0aW9uW2FjdGl2YXRpb25JbmRleCsrXSA9IHRoaXMubGlzdFtpZF0uYWN0aXZhdGUoKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcy5jdXJyZW50QWN0aXZhdGlvbjtcblx0fVxuXG5cdC8vIHByb3BhZ2F0ZXMgdGhlIGVycm9yIG9uIGFsbCB0aGUgbmV1cm9ucyBvZiB0aGUgbGF5ZXJcblx0cHJvcGFnYXRlKHJhdGU6IG51bWJlciwgdGFyZ2V0PzogU3luYXB0aWMuSU51bWVyaWNBcnJheSkge1xuXHRcdGlmICh0eXBlb2YgdGFyZ2V0ICE9ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRpZiAodGFyZ2V0Lmxlbmd0aCAhPSB0aGlzLnNpemUpXG5cdFx0XHRcdHRocm93IFwiVEFSR0VUIHNpemUgYW5kIExBWUVSIHNpemUgbXVzdCBiZSB0aGUgc2FtZSB0byBwcm9wYWdhdGUhXCI7XG5cblx0XHRcdGZvciAodmFyIGlkID0gdGhpcy5saXN0Lmxlbmd0aCAtIDE7IGlkID49IDA7IGlkLS0pIHtcblx0XHRcdFx0dmFyIG5ldXJvbiA9IHRoaXMubGlzdFtpZF07XG5cdFx0XHRcdG5ldXJvbi5wcm9wYWdhdGUocmF0ZSwgdGFyZ2V0W2lkXSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGZvciAodmFyIGlkID0gdGhpcy5saXN0Lmxlbmd0aCAtIDE7IGlkID49IDA7IGlkLS0pIHtcblx0XHRcdFx0dmFyIG5ldXJvbiA9IHRoaXMubGlzdFtpZF07XG5cdFx0XHRcdG5ldXJvbi5wcm9wYWdhdGUocmF0ZSk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0Ly8gcHJvamVjdHMgYSBjb25uZWN0aW9uIGZyb20gdGhpcyBsYXllciB0byBhbm90aGVyIG9uZVxuXHRwcm9qZWN0KGxheWVyOiBuZXR3b3JrLk5ldHdvcmsgfCBMYXllciwgdHlwZT86IHN0cmluZywgd2VpZ2h0cz86IFN5bmFwdGljLklOdW1lcmljQXJyYXkpIHtcblxuXHRcdGlmIChsYXllciBpbnN0YW5jZW9mIG5ldHdvcmsuTmV0d29yaylcblx0XHRcdGxheWVyID0gKDxuZXR3b3JrLk5ldHdvcms+bGF5ZXIpLmxheWVycy5pbnB1dDtcblxuXHRcdGlmIChsYXllciBpbnN0YW5jZW9mIExheWVyKSB7XG5cdFx0XHRpZiAoIXRoaXMuY29ubmVjdGVkKGxheWVyKSlcblx0XHRcdFx0cmV0dXJuIG5ldyBMYXllci5MYXllckNvbm5lY3Rpb24odGhpcywgbGF5ZXIsIHR5cGUsIHdlaWdodHMpO1xuXHRcdH0gZWxzZVxuXHRcdFx0dGhyb3cgXCJJbnZhbGlkIGFyZ3VtZW50LCB5b3UgY2FuIG9ubHkgcHJvamVjdCBjb25uZWN0aW9ucyB0byBMQVlFUlMgYW5kIE5FVFdPUktTIVwiO1xuXG5cblx0fVxuXG5cdC8vIGdhdGVzIGEgY29ubmVjdGlvbiBiZXR3ZW5uIHR3byBsYXllcnNcblx0Z2F0ZShjb25uZWN0aW9uLCB0eXBlKSB7XG5cblx0XHRpZiAodHlwZSA9PSBMYXllci5nYXRlVHlwZS5JTlBVVCkge1xuXHRcdFx0aWYgKGNvbm5lY3Rpb24udG8uc2l6ZSAhPSB0aGlzLnNpemUpXG5cdFx0XHRcdHRocm93IFwiR0FURVIgbGF5ZXIgYW5kIENPTk5FQ1RJT04uVE8gbGF5ZXIgbXVzdCBiZSB0aGUgc2FtZSBzaXplIGluIG9yZGVyIHRvIGdhdGUhXCI7XG5cblx0XHRcdGZvciAodmFyIGlkIGluIGNvbm5lY3Rpb24udG8ubGlzdCkge1xuXHRcdFx0XHR2YXIgbmV1cm9uID0gY29ubmVjdGlvbi50by5saXN0W2lkXTtcblx0XHRcdFx0dmFyIGdhdGVyID0gdGhpcy5saXN0W2lkXTtcblx0XHRcdFx0Zm9yICh2YXIgaW5wdXQgaW4gbmV1cm9uLmNvbm5lY3Rpb25zLmlucHV0cykge1xuXHRcdFx0XHRcdHZhciBnYXRlZCA9IG5ldXJvbi5jb25uZWN0aW9ucy5pbnB1dHNbaW5wdXRdO1xuXHRcdFx0XHRcdGlmIChnYXRlZC5JRCBpbiBjb25uZWN0aW9uLmNvbm5lY3Rpb25zKVxuXHRcdFx0XHRcdFx0Z2F0ZXIuZ2F0ZShnYXRlZCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9IGVsc2UgaWYgKHR5cGUgPT0gTGF5ZXIuZ2F0ZVR5cGUuT1VUUFVUKSB7XG5cdFx0XHRpZiAoY29ubmVjdGlvbi5mcm9tLnNpemUgIT0gdGhpcy5zaXplKVxuXHRcdFx0XHR0aHJvdyBcIkdBVEVSIGxheWVyIGFuZCBDT05ORUNUSU9OLkZST00gbGF5ZXIgbXVzdCBiZSB0aGUgc2FtZSBzaXplIGluIG9yZGVyIHRvIGdhdGUhXCI7XG5cblx0XHRcdGZvciAodmFyIGlkIGluIGNvbm5lY3Rpb24uZnJvbS5saXN0KSB7XG5cdFx0XHRcdHZhciBuZXVyb24gPSBjb25uZWN0aW9uLmZyb20ubGlzdFtpZF07XG5cdFx0XHRcdHZhciBnYXRlciA9IHRoaXMubGlzdFtpZF07XG5cdFx0XHRcdGZvciAodmFyIHByb2plY3RlZCBpbiBuZXVyb24uY29ubmVjdGlvbnMucHJvamVjdGVkKSB7XG5cdFx0XHRcdFx0dmFyIGdhdGVkID0gbmV1cm9uLmNvbm5lY3Rpb25zLnByb2plY3RlZFtwcm9qZWN0ZWRdO1xuXHRcdFx0XHRcdGlmIChnYXRlZC5JRCBpbiBjb25uZWN0aW9uLmNvbm5lY3Rpb25zKVxuXHRcdFx0XHRcdFx0Z2F0ZXIuZ2F0ZShnYXRlZCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9IGVsc2UgaWYgKHR5cGUgPT0gTGF5ZXIuZ2F0ZVR5cGUuT05FX1RPX09ORSkge1xuXHRcdFx0aWYgKGNvbm5lY3Rpb24uc2l6ZSAhPSB0aGlzLnNpemUpXG5cdFx0XHRcdHRocm93IFwiVGhlIG51bWJlciBvZiBHQVRFUiBVTklUUyBtdXN0IGJlIHRoZSBzYW1lIGFzIHRoZSBudW1iZXIgb2YgQ09OTkVDVElPTlMgdG8gZ2F0ZSFcIjtcblxuXHRcdFx0Zm9yICh2YXIgaWQgaW4gY29ubmVjdGlvbi5saXN0KSB7XG5cdFx0XHRcdHZhciBnYXRlciA9IHRoaXMubGlzdFtpZF07XG5cdFx0XHRcdHZhciBnYXRlZCA9IGNvbm5lY3Rpb24ubGlzdFtpZF07XG5cdFx0XHRcdGdhdGVyLmdhdGUoZ2F0ZWQpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRjb25uZWN0aW9uLmdhdGVkZnJvbS5wdXNoKHsgbGF5ZXI6IHRoaXMsIHR5cGU6IHR5cGUgfSk7XG5cdH1cblxuXHQvLyB0cnVlIG9yIGZhbHNlIHdoZXRoZXIgdGhlIHdob2xlIGxheWVyIGlzIHNlbGYtY29ubmVjdGVkIG9yIG5vdFxuXHRzZWxmY29ubmVjdGVkKCk6IGJvb2xlYW4ge1xuXG5cdFx0Zm9yICh2YXIgaWQgaW4gdGhpcy5saXN0KSB7XG5cdFx0XHR2YXIgbmV1cm9uID0gdGhpcy5saXN0W2lkXTtcblx0XHRcdGlmICghbmV1cm9uLnNlbGZjb25uZWN0ZWQoKSlcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdC8vIHRydWUgb2YgZmFsc2Ugd2hldGhlciB0aGUgbGF5ZXIgaXMgY29ubmVjdGVkIHRvIGFub3RoZXIgbGF5ZXIgKHBhcmFtZXRlcikgb3Igbm90XG5cdGNvbm5lY3RlZChsYXllcikge1xuXHRcdC8vIENoZWNrIGlmIEFMTCB0byBBTEwgY29ubmVjdGlvblxuXHRcdHZhciBjb25uZWN0aW9ucyA9IDA7XG5cdFx0Zm9yICh2YXIgaGVyZSBpbiB0aGlzLmxpc3QpIHtcblx0XHRcdGZvciAodmFyIHRoZXJlIGluIGxheWVyLmxpc3QpIHtcblx0XHRcdFx0dmFyIGZyb20gPSB0aGlzLmxpc3RbaGVyZV07XG5cdFx0XHRcdHZhciB0byA9IGxheWVyLmxpc3RbdGhlcmVdO1xuXHRcdFx0XHR2YXIgY29ubmVjdGVkID0gZnJvbS5jb25uZWN0ZWQodG8pO1xuXHRcdFx0XHRpZiAoY29ubmVjdGVkICYmIGNvbm5lY3RlZC50eXBlID09ICdwcm9qZWN0ZWQnKVxuXHRcdFx0XHRcdGNvbm5lY3Rpb25zKys7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmIChjb25uZWN0aW9ucyA9PSB0aGlzLnNpemUgKiBsYXllci5zaXplKVxuXHRcdFx0cmV0dXJuIExheWVyLmNvbm5lY3Rpb25UeXBlLkFMTF9UT19BTEw7XG5cblx0XHQvLyBDaGVjayBpZiBPTkUgdG8gT05FIGNvbm5lY3Rpb25cblx0XHRjb25uZWN0aW9ucyA9IDA7XG5cdFx0Zm9yICh2YXIgbmV1cm9uIGluIHRoaXMubGlzdCkge1xuXHRcdFx0dmFyIGZyb20gPSB0aGlzLmxpc3RbbmV1cm9uXTtcblx0XHRcdHZhciB0byA9IGxheWVyLmxpc3RbbmV1cm9uXTtcblx0XHRcdHZhciBjb25uZWN0ZWQgPSBmcm9tLmNvbm5lY3RlZCh0byk7XG5cdFx0XHRpZiAoY29ubmVjdGVkICYmIGNvbm5lY3RlZC50eXBlID09ICdwcm9qZWN0ZWQnKVxuXHRcdFx0XHRjb25uZWN0aW9ucysrO1xuXHRcdH1cblx0XHRpZiAoY29ubmVjdGlvbnMgPT0gdGhpcy5zaXplKVxuXHRcdFx0cmV0dXJuIExheWVyLmNvbm5lY3Rpb25UeXBlLk9ORV9UT19PTkU7XG5cdH1cblxuXHQvLyBjbGVhcnMgYWxsIHRoZSBuZXVvcm5zIGluIHRoZSBsYXllclxuXHRjbGVhcigpIHtcblx0XHRmb3IgKHZhciBpZCBpbiB0aGlzLmxpc3QpIHtcblx0XHRcdHZhciBuZXVyb24gPSB0aGlzLmxpc3RbaWRdO1xuXHRcdFx0bmV1cm9uLmNsZWFyKCk7XG5cdFx0fVxuXHR9XG5cblx0Ly8gcmVzZXRzIGFsbCB0aGUgbmV1cm9ucyBpbiB0aGUgbGF5ZXJcblx0cmVzZXQoKSB7XG5cdFx0Zm9yICh2YXIgaWQgaW4gdGhpcy5saXN0KSB7XG5cdFx0XHR2YXIgbmV1cm9uID0gdGhpcy5saXN0W2lkXTtcblx0XHRcdG5ldXJvbi5yZXNldCgpO1xuXHRcdH1cblx0fVxuXG5cdC8vIHJldHVybnMgYWxsIHRoZSBuZXVyb25zIGluIHRoZSBsYXllciAoYXJyYXkpXG5cdG5ldXJvbnMoKTogbmV1cm9uLk5ldXJvbltdIHtcblx0XHRyZXR1cm4gdGhpcy5saXN0O1xuXHR9XG5cblx0Ly8gYWRkcyBhIG5ldXJvbiB0byB0aGUgbGF5ZXJcblx0YWRkKG5ldXJvbikge1xuXHRcdG5ldXJvbiA9IG5ldXJvbiB8fCBuZXcgbmV1cm9uLk5ldXJvbigpO1xuXHRcdHRoaXMubmV1cm9uc1tuZXVyb24uSURdID0gbmV1cm9uO1xuXHRcdHRoaXMubGlzdC5wdXNoKG5ldXJvbik7XG5cdFx0dGhpcy5zaXplKys7XG5cdH1cblxuXHRzZXQob3B0aW9ucykge1xuXHRcdG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG5cdFx0Zm9yICh2YXIgaSBpbiB0aGlzLmxpc3QpIHtcblx0XHRcdHZhciBuZXVyb24gPSB0aGlzLmxpc3RbaV07XG5cdFx0XHRpZiAob3B0aW9ucy5sYWJlbClcblx0XHRcdFx0bmV1cm9uLmxhYmVsID0gb3B0aW9ucy5sYWJlbCArICdfJyArIG5ldXJvbi5JRDtcblx0XHRcdGlmIChvcHRpb25zLnNxdWFzaClcblx0XHRcdFx0bmV1cm9uLnNxdWFzaCA9IG9wdGlvbnMuc3F1YXNoO1xuXHRcdFx0aWYgKG9wdGlvbnMuYmlhcylcblx0XHRcdFx0bmV1cm9uLmJpYXMgPSBvcHRpb25zLmJpYXM7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzO1xuXHR9XG59XG5cblxuZXhwb3J0IG1vZHVsZSBMYXllciB7XG5cdGV4cG9ydCB2YXIgbGF5ZXJRdHkgPSAwO1xuXHRleHBvcnQgZnVuY3Rpb24gdWlkKCkge1xuXHRcdHJldHVybiBsYXllclF0eSsrO1xuXHR9XG5cdFxuXHQvLyB0eXBlcyBvZiBjb25uZWN0aW9uc1xuXHRleHBvcnQgdmFyIGNvbm5lY3Rpb25UeXBlID0ge1xuXHRcdEFMTF9UT19BTEw6IFwiQUxMIFRPIEFMTFwiLFxuXHRcdE9ORV9UT19PTkU6IFwiT05FIFRPIE9ORVwiLFxuXHRcdEFMTF9UT19FTFNFOiBcIkFMTCBUTyBFTFNFXCJcblx0fTtcblxuXHQvLyB0eXBlcyBvZiBnYXRlc1xuXHRleHBvcnQgdmFyIGdhdGVUeXBlID0ge1xuXHRcdElOUFVUOiBcIklOUFVUXCIsXG5cdFx0T1VUUFVUOiBcIk9VVFBVVFwiLFxuXHRcdE9ORV9UT19PTkU6IFwiT05FIFRPIE9ORVwiXG5cdH07XG5cblx0Ly8gcmVwcmVzZW50cyBhIGNvbm5lY3Rpb24gZnJvbSBvbmUgbGF5ZXIgdG8gYW5vdGhlciwgYW5kIGtlZXBzIHRyYWNrIG9mIGl0cyB3ZWlnaHQgYW5kIGdhaW5cblx0ZXhwb3J0IGNsYXNzIExheWVyQ29ubmVjdGlvbiB7XG5cdFx0SUQgPSB1aWQoKTtcblx0XHRmcm9tOiBMYXllcjtcblx0XHR0bzogTGF5ZXI7XG5cdFx0c2VsZmNvbm5lY3Rpb246IGJvb2xlYW4gPSBmYWxzZTtcblx0XHR0eXBlOiBzdHJpbmc7XG5cdFx0Y29ubmVjdGlvbnM6IFN5bmFwdGljLkRpY3Rpb25hcnk8bmV1cm9uLk5ldXJvbi5Db25uZWN0aW9uPjtcblx0XHRsaXN0OiBuZXVyb24uTmV1cm9uLkNvbm5lY3Rpb25bXTtcblx0XHRzaXplID0gMDtcblx0XHRnYXRlZGZyb20gPSBbXTtcblxuXHRcdGNvbnN0cnVjdG9yKGZyb21MYXllciwgdG9MYXllciwgdHlwZSwgd2VpZ2h0cykge1xuXHRcdFx0dGhpcy5mcm9tID0gZnJvbUxheWVyO1xuXHRcdFx0dGhpcy50byA9IHRvTGF5ZXI7XG5cdFx0XHR0aGlzLnNlbGZjb25uZWN0aW9uID0gdG9MYXllciA9PSBmcm9tTGF5ZXI7XG5cdFx0XHR0aGlzLnR5cGUgPSB0eXBlO1xuXHRcdFx0dGhpcy5jb25uZWN0aW9ucyA9IHt9O1xuXHRcdFx0dGhpcy5saXN0ID0gW107XG5cdFx0XHR0aGlzLnNpemUgPSAwO1xuXHRcdFx0dGhpcy5nYXRlZGZyb20gPSBbXTtcblxuXG5cdFx0XHRpZiAodHlwZW9mIHRoaXMudHlwZSA9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRpZiAoZnJvbUxheWVyID09IHRvTGF5ZXIpXG5cdFx0XHRcdFx0dGhpcy50eXBlID0gTGF5ZXIuY29ubmVjdGlvblR5cGUuT05FX1RPX09ORTtcblx0XHRcdFx0ZWxzZVxuXHRcdFx0XHRcdHRoaXMudHlwZSA9IExheWVyLmNvbm5lY3Rpb25UeXBlLkFMTF9UT19BTEw7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGlzLnR5cGUgPT0gTGF5ZXIuY29ubmVjdGlvblR5cGUuQUxMX1RPX0FMTCB8fFxuXHRcdFx0XHR0aGlzLnR5cGUgPT0gTGF5ZXIuY29ubmVjdGlvblR5cGUuQUxMX1RPX0VMU0UpIHtcblx0XHRcdFx0Zm9yICh2YXIgaGVyZSBpbiB0aGlzLmZyb20ubGlzdCkge1xuXHRcdFx0XHRcdGZvciAodmFyIHRoZXJlIGluIHRoaXMudG8ubGlzdCkge1xuXHRcdFx0XHRcdFx0dmFyIGZyb20gPSB0aGlzLmZyb20ubGlzdFtoZXJlXTtcblx0XHRcdFx0XHRcdHZhciB0byA9IHRoaXMudG8ubGlzdFt0aGVyZV07XG5cdFx0XHRcdFx0XHRpZiAodGhpcy50eXBlID09IExheWVyLmNvbm5lY3Rpb25UeXBlLkFMTF9UT19FTFNFICYmIGZyb20gPT0gdG8pXG5cdFx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdFx0dmFyIGNvbm5lY3Rpb24gPSBmcm9tLnByb2plY3QodG8sIHdlaWdodHMpO1xuXG5cdFx0XHRcdFx0XHR0aGlzLmNvbm5lY3Rpb25zW2Nvbm5lY3Rpb24uSURdID0gY29ubmVjdGlvbjtcblx0XHRcdFx0XHRcdHRoaXMuc2l6ZSA9IHRoaXMubGlzdC5wdXNoKGNvbm5lY3Rpb24pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmICh0aGlzLnR5cGUgPT0gTGF5ZXIuY29ubmVjdGlvblR5cGUuT05FX1RPX09ORSkge1xuXG5cdFx0XHRcdGZvciAodmFyIG5ldXJvbiBpbiB0aGlzLmZyb20ubGlzdCkge1xuXHRcdFx0XHRcdHZhciBmcm9tID0gdGhpcy5mcm9tLmxpc3RbbmV1cm9uXTtcblx0XHRcdFx0XHR2YXIgdG8gPSB0aGlzLnRvLmxpc3RbbmV1cm9uXTtcblx0XHRcdFx0XHR2YXIgY29ubmVjdGlvbiA9IGZyb20ucHJvamVjdCh0bywgd2VpZ2h0cyk7XG5cblx0XHRcdFx0XHR0aGlzLmNvbm5lY3Rpb25zW2Nvbm5lY3Rpb24uSURdID0gY29ubmVjdGlvbjtcblx0XHRcdFx0XHR0aGlzLnNpemUgPSB0aGlzLmxpc3QucHVzaChjb25uZWN0aW9uKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRmcm9tTGF5ZXIuY29ubmVjdGVkdG8ucHVzaCh0aGlzKTtcblx0XHR9XG5cdH1cbn0iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=